<!DOCTYPE html>






  


<html class="theme-next mist use-motion" lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2"/>
<meta name="theme-color" content="#222">












<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />






















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=6.2.0" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.2.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/logo.jpg?v=6.2.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.2.0">


  <link rel="mask-icon" href="/images/logo.svg?v=6.2.0" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '6.2.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="漫漫长路，伴你同行">
<meta property="og:type" content="website">
<meta property="og:title" content="qin12的学习博客">
<meta property="og:url" content="http://yoursite.com/page/2/index.html">
<meta property="og:site_name" content="qin12的学习博客">
<meta property="og:description" content="漫漫长路，伴你同行">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="qin12的学习博客">
<meta name="twitter:description" content="漫漫长路，伴你同行">



  <link rel="alternate" href="/atom.xml" title="qin12的学习博客" type="application/atom+xml" />




  <link rel="canonical" href="http://yoursite.com/page/2/"/>



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>qin12的学习博客</title>
  









  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">qin12的学习博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">只为成功找方法，不为失败找借口！</p>
      
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>




<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">
    <a href="/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-home"></i> <br />首页</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-photo">
    <a href="/photo/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-photo"></i> <br />摄影</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-music">
    <a href="/music/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-music"></i> <br />音乐</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">
    <a href="/tags/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />标签</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">
    <a href="/categories/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-th"></i> <br />分类</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">
    <a href="/archives/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />归档</a>
  </li>

      
      
    </ul>
  

  
    

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/07/20/消息机制/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Qgx">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="qin12的学习博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/07/20/消息机制/" itemprop="url">
                  我的第一个Android设计第二天
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-07-20 12:10:37" itemprop="dateCreated datePublished" datetime="2018-07-20T12:10:37+08:00">2018-07-20</time>
            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Android/" itemprop="url" rel="index"><span itemprop="name">Android</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="Only-the-original-thread-that-created-a-view-hierarchy-can-touch-its-views"><a href="#Only-the-original-thread-that-created-a-view-hierarchy-can-touch-its-views" class="headerlink" title="Only the original thread that created a view hierarchy can touch its views"></a>Only the original thread that created a view hierarchy can touch its views</h3><p>主线程或者这里说的原始线程original thread 一般情况下是UI线程，当然UI线程并不一定是主线程，我们不能长时间的阻塞该应用<br>举个栗子：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">final Handler cwjHandler = new Handler();</span><br><span class="line"> final Runnable mUpdateResults = new Runnable() &#123;</span><br><span class="line">      public void run() &#123;</span><br><span class="line">          updateUI();</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  @Override</span><br><span class="line">  protected void onCreate(Bundle savedInstanceState) &#123;      super.onCreate(savedInstanceState);</span><br><span class="line">   NetworkOperation();//一个很费时间的I/O操作，比如网络或文件读写等等。</span><br><span class="line">    &#125;</span><br><span class="line">  protected void NetworkOperation() &#123;</span><br><span class="line">      Thread t = new Thread() &#123;</span><br><span class="line">          public void run() &#123;</span><br><span class="line">              doSomething(); //处理得到结果了，这里一些内容保存在主类的成员变量中               cwjHandler.post(mUpdateResults); //高速UI线程可以更新结果了</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;;</span><br><span class="line">      t.start();</span><br><span class="line">  &#125;</span><br><span class="line">  private void updateUI() &#123;</span><br><span class="line">  //详细的更新</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></p>
<p>在分析Android消息机制之前，我们先来看一段代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">public class MainActivity extends Activity implements View.OnClickListener &#123;        </span><br><span class="line">    private TextView stateText;  </span><br><span class="line">    private Button btn;       </span><br><span class="line">    @Override  </span><br><span class="line">    public void onCreate(Bundle savedInstanceState) &#123;       super.onCreate(savedInstanceState);  </span><br><span class="line">        setContentView(R.layout.main);  </span><br><span class="line">        stateText = (TextView) findViewById(R.id.tv);  </span><br><span class="line">        btn = (Button) findViewById(R.id.btn);         </span><br><span class="line">        btn.setOnClickListener(this);  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    @Override  </span><br><span class="line">    public void onClick(View v) &#123;  </span><br><span class="line">        new WorkThread().start();  </span><br><span class="line">    &#125;       </span><br><span class="line">    //工作线程  </span><br><span class="line">    private class WorkThread extends Thread &#123;  </span><br><span class="line">        @Override  </span><br><span class="line">        public void run() &#123;  </span><br><span class="line">            //......处理比较耗时的操作  </span><br><span class="line">             </span><br><span class="line">            //处理完成后改变状态  </span><br><span class="line">        stateText.setText(&quot;completed&quot;);  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>这段代码似乎看上去很正常，但是当你运行时就会发现，它会报一个致命性的异常：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ERROR/AndroidRuntime(421): FATAL EXCEPTION: Thread-8  </span><br><span class="line">ERROR/AndroidRuntime(421): android.view.ViewRoot$CalledFromWrongThreadException:   </span><br><span class="line">Only the original thread that created a view hierarchy can touch its views.</span><br></pre></td></tr></table></figure></p>
<p>原因在于，Android系统中的视图组件并不是线程安全的，如果要更新视图，必须在主线程中更新，不可以在子线程中执行更新的操作。<br>既然这样，我们就在子线程中通知主线程，让主线程来做更新操作。那么我们怎么通知主线程呢？<br>我们就要用到Handler对象。<br>我们修改一下上面的代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">public class MainActivity extends Activity implements View.OnClickListener &#123;  </span><br><span class="line">      </span><br><span class="line">    private static final int COMPLETED = 0;  </span><br><span class="line">      </span><br><span class="line">    private TextView stateText;  </span><br><span class="line">    private Button btn;  </span><br><span class="line">      </span><br><span class="line">    private Handler handler = new Handler() &#123;  </span><br><span class="line">        @Override  </span><br><span class="line">        public void handleMessage(Message msg) &#123;  </span><br><span class="line">            if (msg.what == COMPLETED) &#123;  </span><br><span class="line">                stateText.setText(&quot;completed&quot;);  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;;  </span><br><span class="line">      </span><br><span class="line">    @Override  </span><br><span class="line">    public void onCreate(Bundle savedInstanceState) &#123;  </span><br><span class="line">        super.onCreate(savedInstanceState);  </span><br><span class="line">        setContentView(R.layout.main);  </span><br><span class="line">        stateText = (TextView) findViewById(R.id.tv);  </span><br><span class="line">        btn = (Button) findViewById(R.id.btn);  </span><br><span class="line">          </span><br><span class="line">        btn.setOnClickListener(this);  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    @Override  </span><br><span class="line">    public void onClick(View v) &#123;  </span><br><span class="line">        new WorkThread().start();  </span><br><span class="line">    &#125;  </span><br><span class="line">      </span><br><span class="line">    //工作线程  </span><br><span class="line">    private class WorkThread extends Thread &#123;  </span><br><span class="line">        @Override  </span><br><span class="line">        public void run() &#123;  </span><br><span class="line">            //......处理比较耗时的操作  </span><br><span class="line">              </span><br><span class="line">            //处理完成后给handler发送消息  </span><br><span class="line">            Message msg = new Message();  </span><br><span class="line">            msg.what = COMPLETED;  </span><br><span class="line">            handler.sendMessage(msg);  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>通过上面的这种方式，我们就可以解决线程安全问题，把复杂的任务处理工作交给子线程去完成，然后子线程通过handler对象告知主线程，由主线程更新视图，这个过程中消息机制起着重要的作用。<br>下面我们来分析一下Android中的消息机制，熟悉Windows编程的应该知道Windows程序是消息驱动的，并且有全局的消息循环系统。Google 参考了Windows的消息循环机制，也在Android系统中实现了消息循环机制。Android通过Looper 、Handler 来实现消息循环机制。Android的消息循环是针对线程的，每个线程都可以有自己的消息队列和消息循环。<br>Android系统中Looper.getMainLooper（）得到当前进程的主线程的Looper对象前面提到，Android的消息队列和消息循环都是针对具体线程的，一个线程可以存在一个消息队列和消息循环，特定线程的消息只能分发给本线程，不能跨线程和跨进程通讯。但是创建的工作线程默认是没有消息队列和消息循环的，如果想让工作线程具有消息队列和消息循环，就需要在线程中先调用Looper.prepare()来创建消息队列，然后调用Looper.loop()进入消息循环。下面是我们创建的工作线程：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">class WorkThread extends Thread &#123;  </span><br><span class="line">      public Handler mHandler;  </span><br><span class="line">  </span><br><span class="line">      public void run() &#123;  </span><br><span class="line">          Looper.prepare();  </span><br><span class="line">  </span><br><span class="line">          mHandler = new Handler() &#123;  </span><br><span class="line">              public void handleMessage(Message msg) &#123;  </span><br><span class="line">                  // 处理收到的消息  </span><br><span class="line">              &#125;  </span><br><span class="line">          &#125;;  </span><br><span class="line">  </span><br><span class="line">          Looper.loop();  </span><br><span class="line">      &#125;  </span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></p>
<p>这样一来，我们创建的工作线程就具有了消息处理机制了。</p>
<p>那么，为什么前边的示例中，我们怎么没有看到Looper.prepare()和Looper.loop()的调用呢？原因在于，我们的Activity是一个UI线程，运行在主线程中，Android系统会在Activity启动时为其创建一个消息队列和消息循环。<br>前面提到最多的是消息队列(MessageQueue)和消息循环(Looper)，但是我们看到每个消息处理的地方都有Handler的存在，它是做什么的呢？Handler的作用是把消息加入特定的Looper所管理的消息队列中，并分发和处理该消息队列中的消息。构造Handler的时候可以指定一个Looper对象，如果不指定则利用当前线程的Looper对象创建。下面是Handler的两个构造方法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">/**  </span><br><span class="line">     * Default constructor associates this handler with the queue for the  </span><br><span class="line">     * current thread.  </span><br><span class="line">     *  </span><br><span class="line">     * If there isn&apos;t one, this handler won&apos;t be able to receive messages.  </span><br><span class="line">     */  </span><br><span class="line">    public Handler() &#123;  </span><br><span class="line">        if (FIND_POTENTIAL_LEAKS) &#123;  </span><br><span class="line">            final Class&lt;? extends Handler&gt; klass = getClass();  </span><br><span class="line">            if ((klass.isAnonymousClass() || klass.isMemberClass() || klass.isLocalClass()) &amp;&amp;  </span><br><span class="line">                    (klass.getModifiers() &amp; Modifier.STATIC) == 0) &#123;  </span><br><span class="line">                Log.w(TAG, &quot;The following Handler class should be static or leaks might occur: &quot; +  </span><br><span class="line">                    klass.getCanonicalName());  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;  </span><br><span class="line">  </span><br><span class="line">        mLooper = Looper.myLooper();  </span><br><span class="line">        if (mLooper == null) &#123;  </span><br><span class="line">            throw new RuntimeException(  </span><br><span class="line">                &quot;Can&apos;t create handler inside thread that has not called Looper.prepare()&quot;);  </span><br><span class="line">        &#125;  </span><br><span class="line">        mQueue = mLooper.mQueue;  </span><br><span class="line">        mCallback = null;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">/**  </span><br><span class="line">     * Use the provided queue instead of the default one.  </span><br><span class="line">     */  </span><br><span class="line">    public Handler(Looper looper) &#123;  </span><br><span class="line">        mLooper = looper;  </span><br><span class="line">        mQueue = looper.mQueue;  </span><br><span class="line">        mCallback = null;  </span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>下面是消息机制中几个重要成员的关系图：<br><img src="/img/xiaoxijizhi.png" alt=""><br><img src="/img/xiaoxijizhi2.png" alt=""><br>一个Activity中可以创建出多个工作线程，如果这些线程把他们消息放入Activity主线程的消息队列中，那么消息就会在主线程中处理了。因为主线程一般负责视图组件的更新操作，对于不是线程安全的视图组件来说，这种方式能够很好的实现视图的更新。</p>
<p>那么，子线程如何把消息放入主线程的消息队列中呢？只要Handler对象以主线程的Looper创建，那么当调用Handler的sendMessage方法，系统就会把消息主线程的消息队列，并且将会在调用handleMessage方法时处理主线程消息队列中的消息。</p>
<p>对于子线程访问主线程的Handler对象，你可能会问，多个子线程都访问主线程的Handler对象，发送消息和处理消息的过程中会不会出现数据的不一致呢？答案是Handler对象不会出现问题，因为Handler对象管理的Looper对象是线程安全的，不管是添加消息到消息队列还是从消息队列中读取消息都是同步保护的，所以不会出现数据不一致现象</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/07/20/Spring Boot/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Qgx">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="qin12的学习博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/07/20/Spring Boot/" itemprop="url">
                  Spring Boot(一)
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-07-20 12:10:37" itemprop="dateCreated datePublished" datetime="2018-07-20T12:10:37+08:00">2018-07-20</time>
            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/java/" itemprop="url" rel="index"><span itemprop="name">java</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="Spring-Boot"><a href="#Spring-Boot" class="headerlink" title="Spring Boot"></a>Spring Boot</h3><p>Spring Boot是由Pivotal团队提供的全新框架，其设计目的是用来简化新Spring应用的初始搭建以及开发过程。该框架使用了特定的方式来进行配置，从而使开发人员不再需要定义样板化的配置。通过这种方式，Boot致力于在蓬勃发展的快速应用开发领域（rapid application development）成为领导者。</p>
<h4 id="Spring-Boot的特点"><a href="#Spring-Boot的特点" class="headerlink" title="Spring Boot的特点"></a>Spring Boot的特点</h4><ol>
<li>创建独立的Spring应用程序</li>
<li>直接嵌入Tomcat，Jetty或Undertow，无需部署WAR文件</li>
<li>提供推荐的基础POM文件来简化Apache Maven配置</li>
<li>尽可能的根据项目依赖来自动配置Spring框架</li>
<li>提供生产就绪型功能，如指标，运行状况检查和外部配置</li>
<li>绝对没有代码生成和对XML没有要求配置</li>
</ol>
<h4 id="Spring-Boot的优点"><a href="#Spring-Boot的优点" class="headerlink" title="Spring Boot的优点"></a>Spring Boot的优点</h4><p>spring boot可以支持开发人员快速的开发出restful风格的微服务架构；<br>spring boot自动化确实方便，做微服务再合适不过了，单一jar包部署和管理都非常方便。只要系统架构设计合理，大型项目也能用，加上nginx负载均衡，轻松实现横向扩展；<br>spring boot要解决的问题, 精简配置是一方面, 另外一方面是如何方便的让spring生态圈和其他工具链整合（比如Redis，email，elasticsearch）。</p>
<h4 id="Spring-Boot运行环境"><a href="#Spring-Boot运行环境" class="headerlink" title="Spring Boot运行环境"></a>Spring Boot运行环境</h4><p>Spring Boot（2017-08-18）版本Spring Boot 1.5.6运行环境，Spring官方建议使用JDK1.8<br>        Spring Boot使开发独立的，产品级别的基于Spring的应用变得非常简单，你只需”just run”。 为Spring平台及第三方库提供开箱即用的设置，这样就可以有条不紊地开始。多数Spring Boot应用需要很少的Spring配置。</p>
<p>使用Spring Boot创建Java应用，使用Spring启动或采用传统的war部署方式。Spring Boot提供了一个运行”Spring脚本”的命令行工具。<br>Spring Boot推荐基础POM文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">spring-boot-starter	核心 POM，包含自动配置支持、日志库和对 YAML 配置文件的支持。</span><br><span class="line">spring-boot-starter-amqp	通过 spring-rabbit 支持 AMQP。</span><br><span class="line">spring-boot-starter-aop	包含 spring-aop 和 AspectJ 来支持面向切面编程（AOP）。</span><br><span class="line">spring-boot-starter-batch	支持 Spring Batch，包含 HSQLDB。</span><br><span class="line">spring-boot-starter-data-jpa	包含 spring-data-jpa、spring-orm 和 Hibernate 来支持 JPA。</span><br><span class="line">spring-boot-starter-data-mongodb	包含 spring-data-mongodb 来支持 MongoDB。</span><br><span class="line">spring-boot-starter-data-rest	通过 spring-data-rest-webmvc 支持以 REST 方式暴露 Spring Data 仓库。</span><br><span class="line">spring-boot-starter-jdbc	支持使用 JDBC 访问数据库。</span><br><span class="line">spring-boot-starter-security	包含 spring-security。</span><br><span class="line">spring-boot-starter-test	包含常用的测试所需的依赖，如 JUnit、Hamcrest、Mockito 和 spring-test 等。</span><br><span class="line">spring-boot-starter-velocity	支持使用 Velocity 作为模板引擎。</span><br><span class="line">spring-boot-starter-web	支持 Web 应用开发，包含 Tomcat 和 spring-mvc。</span><br><span class="line">spring-boot-starter-websocket	支持使用 Tomcat 开发 WebSocket 应用。</span><br><span class="line">spring-boot-starter-ws	支持 Spring Web Services。</span><br><span class="line">spring-boot-starter-actuator	添加适用于生产环境的功能，如性能指标和监测等功能。</span><br><span class="line">spring-boot-starter-remote-shell	添加远程 SSH 支持。</span><br><span class="line">spring-boot-starter-jetty	使用 Jetty 而不是默认的 Tomcat 作为应用服务器。</span><br><span class="line">spring-boot-starter-log4j	添加 Log4j 的支持。</span><br><span class="line">spring-boot-starter-logging	使用 Spring Boot 默认的日志框架 Logback。</span><br><span class="line">spring-boot-starter-tomcat	使用 Spring Boot 默认的 Tomcat 作为应用服务器。</span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/07/20/小程序/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Qgx">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="qin12的学习博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/07/20/小程序/" itemprop="url">
                  关于微信小程序webview的使用
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-07-20 12:10:37" itemprop="dateCreated datePublished" datetime="2018-07-20T12:10:37+08:00">2018-07-20</time>
            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/杂七杂八/" itemprop="url" rel="index"><span itemprop="name">杂七杂八</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="小程序"><a href="#小程序" class="headerlink" title="小程序"></a>小程序</h3><p>微信小程序是一种全新的连接用户与服务的方式，它可以在微信内被便捷地获取和传播，同时具有出色的使用体验。同时提供一系列工具帮助开发者快速接入并完成小程序开发。关于如何注册配置就不多言了，本文主要还是体验了下web-view的功能。</p>
<h4 id="web-view详解"><a href="#web-view详解" class="headerlink" title="web-view详解"></a>web-view详解</h4><p>有了这个组件之后，小程序可以很好的嵌入一些页面，可以环境小程序size告急的问题，同样也使开发更加便捷，毕竟小程序开发者基本都对前端开发较为了解。</p>
<h4 id="web-view能力"><a href="#web-view能力" class="headerlink" title="web-view能力"></a>web-view能力</h4><p>说再多还是需要去看官方文档，web-view文档,</p>
<h4 id="兼容"><a href="#兼容" class="headerlink" title="兼容"></a>兼容</h4><p>首先就需要注意：兼容问题，版本库和对应版本比例</p>
<p>基础库 1.6.4 开始支持，低版本需做兼容处理，<br>个人类型与海外类型的小程序暂不支持使用。</p>
<p>目前而言，基本80%的用户会升级微信，所以其实不必担心版本问题，官方截止2017-12-01提供的数据也说明88%的用户支持web-view。</p>
<h4 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h4><p>web-view 组件是一个可以用来承载网页的容器，会自动铺满整个小程序页面；</p>
<p>####属性：<br>src 是String类型，是一个网站的url，默认值是none，webview 指向网页的链接。需登录小程序管理后台配置域名白名单。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- wxml --&gt;</span><br><span class="line">&lt;!-- 指向微信公众平台首页的web-view --&gt;</span><br><span class="line">&lt;web-view src=&quot;https://mp.weixin.qq.com/&quot;&gt;&lt;/web-view&gt;</span><br><span class="line">可以配合Page实例的onLoad方法来获取url的具体值，也就是一个微信小程序页面中只有一个web-view，但是这个web-view的内容可以根据上一个页面传递的参数来获取页面URL，后面会讲如何实践，</span><br></pre></td></tr></table></figure></p>
<p>官方提供如下接口：</p>
<h4 id="web-view和小程序的通信"><a href="#web-view和小程序的通信" class="headerlink" title="web-view和小程序的通信"></a>web-view和小程序的通信</h4><p>由小程序到web-view,其实本质上WEB-VIEW也是小程序的一个页面，所以小程序到web-view是正常的小程序间的通信，通过wx.navigateTo、wx.redirectTo，带上url参数,query参数就像正常url的参数一样跟着后面，然后在web-view的页面的Page实例里面通过onLoad的方法的参数来获取url的值，设置给web-view的src属性为改值即可。<br>由web-view到小程序，由于在web-view的跳转通常是在src对应的网页中的操作来处理的，所以需要结合jssdk来处理，不需要wx.config配置，直接通过script标签来引入<a href="https://res.wx.qq.com/open/js/jweixin-1.3.0.js，就可以使用wx.miniProgram.navigateTo、wx.miniProgram.navigateBack、wx.miniProgram.switchTab、wx.miniProgram.reLaunch、wx.miniProgram.redirectTo接口，就像小程序之间的跳转一样，单是只能在当前小程序页面内跳转。" target="_blank" rel="noopener">https://res.wx.qq.com/open/js/jweixin-1.3.0.js，就可以使用wx.miniProgram.navigateTo、wx.miniProgram.navigateBack、wx.miniProgram.switchTab、wx.miniProgram.reLaunch、wx.miniProgram.redirectTo接口，就像小程序之间的跳转一样，单是只能在当前小程序页面内跳转。</a><br>支持以下部分JSSDK接口图像、音频、摇一摇、地理位置等信息，具体可以查看web-view文档,不过这些需要通过wx.config来授权，就和服务号开发类似。<br>用户分享时可获取当前<web-view>的URL，即在onShareAppMessage回调中返回webViewUrl参数。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">Page(&#123;</span><br><span class="line">  onShareAppMessage(options) &#123;</span><br><span class="line">    console.log(options.webViewUrl)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line">在网页内可通过window.__wxjs_environment变量判断是否在小程序环境。</span><br><span class="line"></span><br><span class="line">// web-view下的页面内</span><br><span class="line">console.log(window.__wxjs_environment === &apos;miniprogram&apos;) // true</span><br><span class="line">web-view实践</span><br><span class="line">在目前实践了部分web-view的功能，</span><br><span class="line"></span><br><span class="line">//index.js</span><br><span class="line">Page(&#123;</span><br><span class="line">    data: &#123;</span><br><span class="line">       url: &apos;https://test.com&apos;</span><br><span class="line">    &#125;,</span><br><span class="line">    onLoad: function(options)&#123;</span><br><span class="line">        options.url ? this.setData(&#123;url: options.url&#125;) : wx.navigateBack(&#123;delta: 2&#125;);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">//index.wxml</span><br><span class="line">&lt;web-view src=&quot;&#123;&#123;url&#125;&#125;&quot;&gt;&lt;/web-view&gt;</span><br><span class="line">在这个web-view中，指向的就是https://test.com的内容，所以在在https://test.com中跳转出回到小程序，需要修改https://test.com中的JavaScript,</span><br><span class="line"></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span><br><span class="line">    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;ie=edge&quot;&gt;</span><br><span class="line">    &lt;title&gt;test&lt;/title&gt;</span><br><span class="line">    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://test.com/index.css&quot; /&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;div class=&quot;app&quot;&gt;</span><br><span class="line">        &lt;h1&gt;webview-wechat-detail&lt;/h1&gt;</span><br><span class="line">        &lt;p&gt;</span><br><span class="line">            detail</span><br><span class="line">        &lt;/p&gt;</span><br><span class="line">        &lt;button type=&quot;button&quot; id=&quot;btn&quot;&gt;返回小程序&lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;script src=&quot;https://test.com/jquery.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;script src=&quot;https://res.wx.qq.com/open/js/jweixin-1.3.0.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;script&gt;</span><br><span class="line">        /* eslint-disable */</span><br><span class="line">$(function()&#123;</span><br><span class="line">    doucument.cookie = &apos;bb=bbbbbb&apos;;</span><br><span class="line">    $(&apos;#btn&apos;).on(&apos;click&apos;,function(s) &#123;</span><br><span class="line">        document.cookie = &apos;aa=ssssss&apos;;</span><br><span class="line">        wx.miniProgram.navigateTo(&#123;</span><br><span class="line">            url:&apos;/pages/index?test=testtest&apos;,</span><br><span class="line">            success: function()&#123;</span><br><span class="line">                console.log(&apos;success&apos;)</span><br><span class="line">            &#125;,</span><br><span class="line">            fail: function()&#123;</span><br><span class="line">                console.log(&apos;fail&apos;);</span><br><span class="line">            &#125;,</span><br><span class="line">            complete:function()&#123;</span><br><span class="line">                console.log(&apos;complete&apos;);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">    &lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line">如果需要使用一些其他的的jssdk的方法，那就需要参照公众号的开发配置了。</span><br></pre></td></tr></table></figure></web-view></p>
<h4 id="web-view采坑"><a href="#web-view采坑" class="headerlink" title="web-view采坑"></a>web-view采坑</h4><p>由于很多使用中的一些问题<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1.打开的域名没有在小程序管理后台设置业务域名（注意是业务域名，不是服务器域名）</span><br><span class="line">2.打开的页面必须为https服务</span><br><span class="line">3.打开的页面302过去的地址也必须设置过业务域名</span><br><span class="line">4.web-view空白问题，请升级微信客户端到 6.5.16</span><br><span class="line">5.页面可以包含iframe，但是iframe的地址必须为业务域名</span><br><span class="line">6.web-view不支持支付能力，web-view的API能力见web-view的文档说明</span><br><span class="line">7.开发者自己检查自己的https服务是否正常，测试方法：普通浏览器打开对应的地址</span><br><span class="line">8.如果web-view使用了公众号授权的服务，开发者工具提示网页开发者的问题，请见：公众号开发</span><br></pre></td></tr></table></figure></p>
<p>其他的问题注意：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">每个页面只能有一个&lt;web-view/&gt;，&lt;web-view/&gt;会自动铺满整个页面，并覆盖其他组件，小程序对webview的监控状态基本没有，只能设置src设置url。</span><br><span class="line">关于小程序和web-view的通信，&lt;web-view/&gt; → 小程序只能通过JSSDK 1.3.0提供的接口返回小程序页面，设置参数来传值，反之，小程序到webview也是一样的，只能是src的路径带上参数；</span><br><span class="line">web-view不支持支付能力,是指无法唤起小程序的直接支付窗口，对于h5的那套支付应该是支持的，但是web-view 里边没法使用 微信支付的 JSAPI，也就是可能可以h5的相关的的支付中心来支付；</span><br><span class="line">关于层级，在webview中可以无限跳转，对于导航条返回和物理键返回都会回到上一个页面直到退出webview，就像history.back。</span><br><span class="line">webview中的html的title会自动放到小程序的头部作为标题；</span><br><span class="line">webview中可以正常使用ajax之类的操作。</span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/07/20/Apache下https服务的配置/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Qgx">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="qin12的学习博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/07/20/Apache下https服务的配置/" itemprop="url">
                  Apache下https服务的配置
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-07-20 12:10:37" itemprop="dateCreated datePublished" datetime="2018-07-20T12:10:37+08:00">2018-07-20</time>
            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/javaEE/" itemprop="url" rel="index"><span itemprop="name">javaEE</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="Apache下https服务的配置"><a href="#Apache下https服务的配置" class="headerlink" title="Apache下https服务的配置"></a>Apache下https服务的配置</h3><h4 id="1-下载证书，一般为四个文件"><a href="#1-下载证书，一般为四个文件" class="headerlink" title="1.下载证书，一般为四个文件"></a>1.下载证书，一般为四个文件</h4><p>注意：服务器不一样，证书的数量可能不一样<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">214132021230522.key</span><br><span class="line">214132021230522.pem</span><br><span class="line">chain.pem</span><br><span class="line">public.pem</span><br></pre></td></tr></table></figure></p>
<h4 id="2-在apache的配置文件-httpd-conf-中-对以下两句话取消注释"><a href="#2-在apache的配置文件-httpd-conf-中-对以下两句话取消注释" class="headerlink" title="2.在apache的配置文件(httpd.conf)中,对以下两句话取消注释"></a>2.在apache的配置文件(httpd.conf)中,对以下两句话取消注释</h4><p>注意：第一条加载ssl，第二天引入配置文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">LoadModule ssl_module modules/mod_ssl.so</span><br><span class="line">Include conf/extra/httpd-ssl.conf</span><br></pre></td></tr></table></figure></p>
<h4 id="3-配置httpd-ssl-conf文件，加入主机信息和证书路径"><a href="#3-配置httpd-ssl-conf文件，加入主机信息和证书路径" class="headerlink" title="3.配置httpd-ssl.conf文件，加入主机信息和证书路径"></a>3.配置httpd-ssl.conf文件，加入主机信息和证书路径</h4><p>注意: 路径配置错误可能打不开服务器</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">Listen 443</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">SSLPassPhraseDialog  builtin</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">SSLSessionCache        &quot;shmcb:/Apache24/logs/ssl_scache(512000)&quot;</span><br><span class="line">SSLSessionCacheTimeout  300</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;VirtualHost _default_:443&gt;</span><br><span class="line"></span><br><span class="line">DocumentRoot &quot;E:\web\public&quot;</span><br><span class="line">ServerName www.abc.com:443</span><br><span class="line">ServerAdmin admin@example.com</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">SSLEngine on</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">SSLCipherSuite ALL:!ADH:!EXPORT56:RC4+RSA:+HIGH:+MEDIUM:+LOW:+SSLv2:+EXP:+eNULL</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">SSLCertificateFile &quot;C:\Apache24\cert\www\public.pem&quot;</span><br><span class="line"></span><br><span class="line">SSLCertificateKeyFile &quot;C:\Apache24\cert\www\214132021230522.key&quot;</span><br><span class="line"></span><br><span class="line">SSLCertificateChainFile &quot;C:\Apache24\cert\www\chain.pem&quot;</span><br><span class="line"></span><br><span class="line">&lt;FilesMatch &quot;\.(cgi|shtml|phtml|php)$&quot;&gt;</span><br><span class="line">    SSLOptions +StdEnvVars</span><br><span class="line">&lt;/FilesMatch&gt;</span><br><span class="line">&lt;Directory &quot;/Apache24/cgi-bin&quot;&gt;</span><br><span class="line">    SSLOptions +StdEnvVars</span><br><span class="line">&lt;/Directory&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">BrowserMatch &quot;.*MSIE.*&quot; \</span><br><span class="line">         nokeepalive ssl-unclean-shutdown \</span><br><span class="line">         downgrade-1.0 force-response-1.0</span><br><span class="line"></span><br><span class="line">#   Per-Server Logging:</span><br><span class="line">#   The home of a custom SSL log file. Use this when you want a</span><br><span class="line">#   compact non-error SSL logfile on a virtual host basis.</span><br><span class="line">CustomLog &quot;/Apache24/logs/ssl_request.log&quot; \</span><br><span class="line">          &quot;%t %h %&#123;SSL_PROTOCOL&#125;x %&#123;SSL_CIPHER&#125;x \&quot;%r\&quot; %b&quot;</span><br><span class="line"></span><br><span class="line">&lt;/VirtualHost&gt;</span><br></pre></td></tr></table></figure>
<h4 id="4-在网站根目录的-htaccess文件中配置跳转"><a href="#4-在网站根目录的-htaccess文件中配置跳转" class="headerlink" title="4.在网站根目录的.htaccess文件中配置跳转"></a>4.在网站根目录的.htaccess文件中配置跳转</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;IfModule mod_rewrite.c&gt;</span><br><span class="line">RewriteEngine on</span><br><span class="line">RewriteBase /</span><br><span class="line">RewriteCond %&#123;SERVER_PORT&#125; !^443$</span><br><span class="line">RewriteRule ^.*$ https://%&#123;SERVER_NAME&#125;%&#123;REQUEST_URI&#125; [L,R]</span><br><span class="line">&lt;/IfModule&gt;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/07/20/1、IO流概述/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Qgx">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="qin12的学习博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/07/20/1、IO流概述/" itemprop="url">
                  java 基础知识
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-07-20 12:10:37" itemprop="dateCreated datePublished" datetime="2018-07-20T12:10:37+08:00">2018-07-20</time>
            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/java/" itemprop="url" rel="index"><span itemprop="name">java</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="1、IO流概述"><a href="#1、IO流概述" class="headerlink" title="1、IO流概述"></a>1、IO流概述</h3><ul>
<li><p>(1)用来处理设备(硬盘，控制台，内存)间的数据。</p>
</li>
<li><p>(2)java中对数据的操作都是通过流的方式。</p>
</li>
<li><p>(3)java用于操作流的类都在io包中。</p>
</li>
<li><p>(4)按照流操作的数据的类型不同：分为字节流和字符流。字符流是为了方便中文的操作而来的。</p>
</li>
<li><p>(5)按照流的流向不同分为：输入流，输出流</p>
</li>
</ul>
<h3 id="2、IO流常用基类："><a href="#2、IO流常用基类：" class="headerlink" title="2、IO流常用基类："></a>2、IO流常用基类：</h3><h4 id="1-字节流"><a href="#1-字节流" class="headerlink" title="(1)字节流"></a>(1)字节流</h4><p>输出字节流：OutputStream：字节写入流抽象类</p>
<p>|—&gt;FileOutputStream：<br>字节写入流<br>|—&gt;BufferedOutputStream：</p>
<p>字节写入流缓冲区<br>|—&gt;PrintStream：</p>
<p>打印流<br>输入字节流：InputStream：字节读取流抽象类</p>
<p>|—&gt;FileInputStream：<br>字节读取流</p>
<p>|—&gt;BufferedInputStream：<br>字节读取流缓冲区</p>
<h4 id="2-字符流"><a href="#2-字符流" class="headerlink" title="(2)字符流"></a>(2)字符流</h4><p>输出字符流：Writer：字符写入流的抽象<br>|—&gt;FileWriter：<br>字符写入流</p>
<p>|—&gt;BufferedWriter：<br>字符写入流缓冲区</p>
<p>|—&gt;OutputStreamWriter：<br>字符通向字节的转换流(涉及键盘录入时用)</p>
<p>|—&gt;OutputStreamWriter：<br>打印流，可处理各种类型的数据</p>
<p>输入字符流：Reader: 字符读取流的抽象类</p>
<p>|—&gt;FileReader：<br>字符读取流<br>|—&gt;LineNumberReader：</p>
<p>跟踪行号的缓冲字符读取流<br>|—&gt;BufferedReader：<br>字符读取流缓冲区</p>
<p>|—&gt;InputStreamReader：<br>字节通向字符的转换流(涉及键盘录入时用)</p>
<h4 id="3-IO流常用基类方法摘要："><a href="#3-IO流常用基类方法摘要：" class="headerlink" title="(3)IO流常用基类方法摘要："></a>(3)IO流常用基类方法摘要：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">字节写入流：OutputStream：</span><br><span class="line">void close() 关闭此输出流并释放与此流有关的所有系统资源。</span><br><span class="line"></span><br><span class="line">void flush()刷新此输出流并强制写出所有缓冲的输出字节。</span><br><span class="line"></span><br><span class="line">abstract  void write(int b)  将指定的字节写入此输出流。</span><br><span class="line"></span><br><span class="line">void write(byte[] b) 将 b.length 个字节从指定的 byte 数组写入此输出流。    </span><br><span class="line"></span><br><span class="line">void write(byte[] b, int off, int len) </span><br><span class="line"></span><br><span class="line">将指定 byte 数组中从偏移量 off 开始的 len 个字节写入此输出流。 </span><br><span class="line"></span><br><span class="line">字节读取流：InputStream：</span><br><span class="line"></span><br><span class="line">void close() 关闭此输入流并释放与该流关联的所有系统资源。</span><br><span class="line"></span><br><span class="line">int available() (特有方法！！)</span><br><span class="line"></span><br><span class="line">返回此输入流下一个方法调用可以不受阻塞地从此输入流读取（或跳过）的估计字节数。 </span><br><span class="line"></span><br><span class="line">abstract  int read() 从输入流中读取数据的下一个字节。 </span><br><span class="line"></span><br><span class="line">int read(byte[] b) 从输入流中读取一定数量的字节，并将其存储在缓冲区数组 b 中。</span><br><span class="line"></span><br><span class="line">int read(byte[] b, int off, int len)  将输入流中最多 len 个数据字节读入 byte 数组。</span><br><span class="line"></span><br><span class="line">long skip(long n) 跳过和丢弃此输入流中数据的 n 个字节。</span><br><span class="line">  </span><br><span class="line">字符写入流：Writer：</span><br><span class="line">abstract  void close() 关闭此流，但要先刷新它。</span><br><span class="line"></span><br><span class="line">abstract  void flush() 刷新该流的缓冲。</span><br><span class="line"></span><br><span class="line">void write(int c) 写入单个字符。</span><br><span class="line"></span><br><span class="line">void write(char[] cbuf) 写入字符数组。          </span><br><span class="line"></span><br><span class="line">abstract  void write(char[] cbuf, int off, int len) 写入字符数组的某一部分。 </span><br><span class="line"></span><br><span class="line">void write(String str) 写入字符串。 </span><br><span class="line"></span><br><span class="line">void write(String str, int off, int len) 写入字符串的某一部分。 </span><br><span class="line"></span><br><span class="line">字符读取流：Reader：</span><br><span class="line">abstract  void close() 关闭该流并释放与之关联的所有资源。</span><br><span class="line"></span><br><span class="line">int read() 读取单个字符。</span><br><span class="line"></span><br><span class="line">int read(char[] cbuf)  将字符读入数组</span><br><span class="line"></span><br><span class="line">abstract  int read(char[] cbuf, int off, int len) 将字符读入数组的某一部分。</span><br><span class="line"></span><br><span class="line">long skip(long n)  跳过字符。</span><br></pre></td></tr></table></figure>
<h3 id="3、IO流常用字节流基类的子类："><a href="#3、IO流常用字节流基类的子类：" class="headerlink" title="3、IO流常用字节流基类的子类："></a>3、IO流常用字节流基类的子类：</h3><p>写入流：</p>
<h4 id="1-FileOutputStream："><a href="#1-FileOutputStream：" class="headerlink" title="(1)FileOutputStream："></a>(1)FileOutputStream：</h4><p>构造方法：</p>
<p>FileOutputStream(String name) </p>
<p>创建一个向具有指定名称的文件中写入数据的输出文件流。</p>
<p>FileOutputStream(String name, boolean append) </p>
<p>创建一个向具有指定 name 的文件中写入数据的输出文件流。</p>
<p>FileOutputStream(File file) </p>
<p>创建一个向指定 File 对象表示的文件中写入数据的文件输出流。 </p>
<p>FileOutputStream(File file, boolean append) </p>
<p>创建一个向指定 File 对象表示的文件中写入数据的文件输出流。</p>
<p>方法摘要：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">public void flush()</span><br><span class="line"></span><br><span class="line">void close() 关闭此文件输出流并释放与此流有关的所有系统资源。</span><br><span class="line"></span><br><span class="line">void write(int b) 将指定字节写入此文件输出流。</span><br><span class="line"></span><br><span class="line">void write(byte[] b, int off, int len) </span><br><span class="line"></span><br><span class="line">将指定 byte 数组中从偏移量 off 开始的 len 个字节写入此文件输出流。 </span><br><span class="line"></span><br><span class="line">void write(int b) 将指定字节写入此文件输出流。</span><br></pre></td></tr></table></figure></p>
<h4 id="2-BufferedOutputStream："><a href="#2-BufferedOutputStream：" class="headerlink" title="(2)BufferedOutputStream："></a>(2)BufferedOutputStream：</h4><p>构造方法：<br>BufferedOutputStream(OutputStream out) </p>
<p>创建一个新的缓冲输出流，以将数据写入指定的底层输出流。 </p>
<p>BufferedOutputStream(OutputStream out, int size) </p>
<p>创建一个新的缓冲输出流，以将具有指定缓冲区大小的数据写入指定的底层输出流。 </p>
<p>方法摘要：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">void flush() 刷新此缓冲的输出流。          </span><br><span class="line"></span><br><span class="line">void write(byte[] b, int off, int len) </span><br><span class="line"></span><br><span class="line">将指定 byte 数组中从偏移量 off 开始的 len 个字节写入此缓冲的输出流。 void write(int b) 将指定的字节写入此缓冲的输出流。</span><br></pre></td></tr></table></figure></p>
<h4 id="3-PrintStream：打印流，可将各种类型的数据原样打印，有自动刷新功能"><a href="#3-PrintStream：打印流，可将各种类型的数据原样打印，有自动刷新功能" class="headerlink" title="(3)PrintStream：打印流，可将各种类型的数据原样打印，有自动刷新功能"></a>(3)PrintStream：打印流，可将各种类型的数据原样打印，有自动刷新功能</h4><p>构造方法：</p>
<p>PrintStream(String fileName)<br>创建具有指定文件名称且不带自动行刷新的新打印流。</p>
<p>PrintStream(File file) 创建具有指定文件且不带自动行刷新的新打印流。<br>PrintStream(OutputStream out) </p>
<p>创建新的打印流。</p>
<p>PrintStream(OutputStream out, boolean autoFlush) (当autoFlush为true时具有自动刷新功能)<br>创建新的打印流。</p>
<p>方法摘要：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">PrintStream append(char c) 将指定字符添加到此输出流。</span><br><span class="line">void close() </span><br><span class="line"></span><br><span class="line">关闭流。 void flush() 刷新该流的缓冲。void print(各种类型的数据：) 打印各种类型的数据 void println(各种类型的数据：)：自动换行打印各种类型的数据 void write(byte[] buf, int off, int len) 将 len 字节从指定的初始偏移量为 off 的 byte 数组写入此流。 void write(int b) 将指定的字节写入此流。</span><br></pre></td></tr></table></figure></p>
<h3 id="读取流："><a href="#读取流：" class="headerlink" title="读取流："></a>读取流：</h3><h4 id="1-FileInputStream："><a href="#1-FileInputStream：" class="headerlink" title="(1)FileInputStream："></a>(1)FileInputStream：</h4><p>构造方法：FileInputStream(String name) 通过打开一个到实际文件的连接来创建一个 FileInputStream，该文件通过文件系统中的路径名 name 指定。FileInputStream(File file) 通过打开一个到实际文件的连接来创建一个 FileInputStream，<br>该文件通过文件系统中的 File 对象 file 指定。</p>
<p>方法摘要：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">int available() (字节读取流特有方法！！！)返回下一次对此输入流调用的方法可以不受阻塞地从此输入流读取（或跳过）的估计剩余字节数。int read() 从此输入流中读取一个数据字节。 int read(byte[] b) 从此输入流中将最多 b.length 个字节的数据读入一个 byte 数组中。 int read(byte[] b, int off, int len) 从此输入流中将最多 len 个字节的数据读入一个 byte 数组中。 long skip(long n) </span><br><span class="line">从输入流中跳过并丢弃 n 个字节的数据。</span><br></pre></td></tr></table></figure></p>
<h4 id="2-BufferedInputStream"><a href="#2-BufferedInputStream" class="headerlink" title="(2)BufferedInputStream:"></a>(2)BufferedInputStream:</h4><p>构造方法：BufferedInputStream(InputStream in) 创建一个 BufferedInputStream 并保存其参数，即输入流 in，以便将来使用。 BufferedInputStream(InputStream in, int size)<br>创建具有指定缓冲区大小的 BufferedInputStream 并保存其参数，即输入流 in，以便将来使用。</p>
<p>方法摘要：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">int available() (字节读取流特有方法！！！)返回可以从此输入流读取（或跳过）、且不受此输入流接下来的方法调用阻塞的估计字节数。 int read() 参见 InputStream 的 read 方法的常规协定。 int read(byte[] b, int off, int len) 从此字节输入流中给定偏移量处开始将各字节读取到指定的 byte 数组中。 long skip(long n) </span><br><span class="line">参见 InputStream 的 skip 方法的常规协定。</span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/07/20/ListView联动（二）/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Qgx">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="qin12的学习博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/07/20/ListView联动（二）/" itemprop="url">
                  Android ListView联动
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-07-20 12:10:37" itemprop="dateCreated datePublished" datetime="2018-07-20T12:10:37+08:00">2018-07-20</time>
            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Android/" itemprop="url" rel="index"><span itemprop="name">Android</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="ListView联动（二）"><a href="#ListView联动（二）" class="headerlink" title="ListView联动（二）"></a>ListView联动（二）</h3><p>双ListView分为左侧ListView和右侧ListView，通过左侧ListView的点击来定位右侧ListView的位置，通过右侧ListView的滑动来定位左侧ListView的选中位置。左侧ListView我们直接使用原生ListView即可，右侧ListView由于需要头部标题和滑动监听，我们自己定义一个ListView，来设置下滑动事件的监听和头部标题。<br>实现双ListView联动最关键的一点就是这个自定义ListView，代码如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br></pre></td><td class="code"><pre><span class="line">package com.example.qgx.gouwuche;</span><br><span class="line"></span><br><span class="line">import android.content.Context;</span><br><span class="line">import android.graphics.Canvas;</span><br><span class="line">import android.util.AttributeSet;</span><br><span class="line">import android.view.View;</span><br><span class="line">import android.view.ViewGroup;</span><br><span class="line">import android.widget.AbsListView;</span><br><span class="line">import android.widget.AbsListView.OnScrollListener;</span><br><span class="line">import android.widget.AdapterView;</span><br><span class="line">import android.widget.HeaderViewListAdapter;</span><br><span class="line">import android.widget.ListAdapter;</span><br><span class="line">import android.widget.ListView;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">public class PinnedHeaderListView extends ListView implements OnScrollListener &#123;</span><br><span class="line"></span><br><span class="line">    private OnScrollListener mOnScrollListener;</span><br><span class="line"></span><br><span class="line">    public static interface PinnedSectionedHeaderAdapter &#123;</span><br><span class="line">        public boolean isSectionHeader(int position);</span><br><span class="line"></span><br><span class="line">        public int getSectionForPosition(int position);</span><br><span class="line"></span><br><span class="line">        public View getSectionHeaderView(int section, View convertView, ViewGroup parent);</span><br><span class="line"></span><br><span class="line">        public int getSectionHeaderViewType(int section);</span><br><span class="line"></span><br><span class="line">        public int getCount();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private PinnedSectionedHeaderAdapter mAdapter;</span><br><span class="line">    private View mCurrentHeader;</span><br><span class="line">    private int mCurrentHeaderViewType = 0;</span><br><span class="line">    private float mHeaderOffset;</span><br><span class="line">    private boolean mShouldPin = true;</span><br><span class="line">    private int mCurrentSection = 0;</span><br><span class="line">    private int mWidthMode;</span><br><span class="line">    private int mHeightMode;</span><br><span class="line"></span><br><span class="line">    public PinnedHeaderListView(Context context) &#123;</span><br><span class="line">        super(context);</span><br><span class="line">        super.setOnScrollListener(this);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public PinnedHeaderListView(Context context, AttributeSet attrs) &#123;</span><br><span class="line">        super(context, attrs);</span><br><span class="line">        super.setOnScrollListener(this);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public PinnedHeaderListView(Context context, AttributeSet attrs, int defStyle) &#123;</span><br><span class="line">        super(context, attrs, defStyle);</span><br><span class="line">        super.setOnScrollListener(this);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setPinHeaders(boolean shouldPin) &#123;</span><br><span class="line">        mShouldPin = shouldPin;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void setAdapter(ListAdapter adapter) &#123;</span><br><span class="line">        mCurrentHeader = null;</span><br><span class="line">        mAdapter = (PinnedSectionedHeaderAdapter) adapter;</span><br><span class="line">        super.setAdapter(adapter);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void onScroll(AbsListView view, int firstVisibleItem, int visibleItemCount, int totalItemCount) &#123;</span><br><span class="line">        if (mOnScrollListener != null) &#123;</span><br><span class="line">            mOnScrollListener.onScroll(view, firstVisibleItem, visibleItemCount, totalItemCount);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        if (mAdapter == null || mAdapter.getCount() == 0 || !mShouldPin || (firstVisibleItem &lt; getHeaderViewsCount())) &#123;</span><br><span class="line">            mCurrentHeader = null;</span><br><span class="line">            mHeaderOffset = 0.0f;</span><br><span class="line">            for (int i = firstVisibleItem; i &lt; firstVisibleItem + visibleItemCount; i++) &#123;</span><br><span class="line">                View header = getChildAt(i);</span><br><span class="line">                if (header != null) &#123;</span><br><span class="line">                    header.setVisibility(VISIBLE);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        firstVisibleItem -= getHeaderViewsCount();</span><br><span class="line"></span><br><span class="line">        int section = mAdapter.getSectionForPosition(firstVisibleItem);</span><br><span class="line">        int viewType = mAdapter.getSectionHeaderViewType(section);</span><br><span class="line">        mCurrentHeader = getSectionHeaderView(section, mCurrentHeaderViewType != viewType ? null : mCurrentHeader);</span><br><span class="line">        ensurePinnedHeaderLayout(mCurrentHeader);</span><br><span class="line">        mCurrentHeaderViewType = viewType;</span><br><span class="line"></span><br><span class="line">        mHeaderOffset = 0.0f;</span><br><span class="line"></span><br><span class="line">        for (int i = firstVisibleItem; i &lt; firstVisibleItem + visibleItemCount; i++) &#123;</span><br><span class="line">            if (mAdapter.isSectionHeader(i)) &#123;</span><br><span class="line">                View header = getChildAt(i - firstVisibleItem);</span><br><span class="line">                float headerTop = header.getTop();</span><br><span class="line">                float pinnedHeaderHeight = mCurrentHeader.getMeasuredHeight();</span><br><span class="line">                header.setVisibility(VISIBLE);</span><br><span class="line">                if (pinnedHeaderHeight &gt;= headerTop &amp;&amp; headerTop &gt; 0) &#123;</span><br><span class="line">                    mHeaderOffset = headerTop - header.getHeight();</span><br><span class="line">                &#125; else if (headerTop &lt;= 0) &#123;</span><br><span class="line">                    header.setVisibility(INVISIBLE);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        invalidate();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void onScrollStateChanged(AbsListView view, int scrollState) &#123;</span><br><span class="line">        if (mOnScrollListener != null) &#123;</span><br><span class="line">            mOnScrollListener.onScrollStateChanged(view, scrollState);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private View getSectionHeaderView(int section, View oldView) &#123;</span><br><span class="line">        boolean shouldLayout = section != mCurrentSection || oldView == null;</span><br><span class="line"></span><br><span class="line">        View view = mAdapter.getSectionHeaderView(section, oldView, this);</span><br><span class="line">        if (shouldLayout) &#123;</span><br><span class="line">            // a new section, thus a new header. We should lay it out again</span><br><span class="line">            ensurePinnedHeaderLayout(view);</span><br><span class="line">            mCurrentSection = section;</span><br><span class="line">        &#125;</span><br><span class="line">        return view;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void ensurePinnedHeaderLayout(View header) &#123;</span><br><span class="line">        if (header.isLayoutRequested()) &#123;</span><br><span class="line">            int widthSpec = MeasureSpec.makeMeasureSpec(getMeasuredWidth(), mWidthMode);</span><br><span class="line"></span><br><span class="line">            int heightSpec;</span><br><span class="line">            ViewGroup.LayoutParams layoutParams = header.getLayoutParams();</span><br><span class="line">            if (layoutParams != null &amp;&amp; layoutParams.height &gt; 0) &#123;</span><br><span class="line">                heightSpec = MeasureSpec.makeMeasureSpec(layoutParams.height, MeasureSpec.EXACTLY);</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                heightSpec = MeasureSpec.makeMeasureSpec(0, MeasureSpec.UNSPECIFIED);</span><br><span class="line">            &#125;</span><br><span class="line">            header.measure(widthSpec, heightSpec);</span><br><span class="line">            header.layout(0, 0, header.getMeasuredWidth(), header.getMeasuredHeight());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void dispatchDraw(Canvas canvas) &#123;</span><br><span class="line">        super.dispatchDraw(canvas);</span><br><span class="line">        if (mAdapter == null || !mShouldPin || mCurrentHeader == null)</span><br><span class="line">            return;</span><br><span class="line">        int saveCount = canvas.save();</span><br><span class="line">        canvas.translate(0, mHeaderOffset);</span><br><span class="line">        canvas.clipRect(0, 0, getWidth(), mCurrentHeader.getMeasuredHeight()); // needed</span><br><span class="line">        // for</span><br><span class="line">        // &lt;</span><br><span class="line">        // HONEYCOMB</span><br><span class="line">        mCurrentHeader.draw(canvas);</span><br><span class="line">        canvas.restoreToCount(saveCount);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void setOnScrollListener(OnScrollListener l) &#123;</span><br><span class="line">        mOnScrollListener = l;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void onMeasure(int widthMeasureSpec, int heightMeasureSpec) &#123;</span><br><span class="line">        super.onMeasure(widthMeasureSpec, heightMeasureSpec);</span><br><span class="line"></span><br><span class="line">        mWidthMode = MeasureSpec.getMode(widthMeasureSpec);</span><br><span class="line">        mHeightMode = MeasureSpec.getMode(heightMeasureSpec);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setOnItemClickListener(OnItemClickListener listener) &#123;</span><br><span class="line">        super.setOnItemClickListener(listener);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static abstract class OnItemClickListener implements AdapterView.OnItemClickListener &#123;</span><br><span class="line">        @Override</span><br><span class="line">        public void onItemClick(AdapterView&lt;?&gt; adapterView, View view, int rawPosition, long id) &#123;</span><br><span class="line">            SectionedBaseAdapter adapter;</span><br><span class="line">            if (adapterView.getAdapter().getClass().equals(HeaderViewListAdapter.class)) &#123;</span><br><span class="line">                HeaderViewListAdapter wrapperAdapter = (HeaderViewListAdapter) adapterView.getAdapter();</span><br><span class="line">                adapter = (SectionedBaseAdapter) wrapperAdapter.getWrappedAdapter();</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                adapter = (SectionedBaseAdapter) adapterView.getAdapter();</span><br><span class="line">            &#125;</span><br><span class="line">            int section = adapter.getSectionForPosition(rawPosition);</span><br><span class="line">            int position = adapter.getPositionInSectionForPosition(rawPosition);</span><br><span class="line"></span><br><span class="line">            if (position == -1) &#123;</span><br><span class="line">                onSectionClick(adapterView, view, section, id);</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                onItemClick(adapterView, view, section, position, id);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public abstract void onItemClick(AdapterView&lt;?&gt; adapterView, View view, int section, int position, long id);</span><br><span class="line"></span><br><span class="line">        public abstract void onSectionClick(AdapterView&lt;?&gt; adapterView, View view, int section, long id);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>然后为PinnedHeaderListView定义Adapter，代码如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br></pre></td><td class="code"><pre><span class="line">package com.example.qgx.gouwuche;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">import android.util.SparseArray;</span><br><span class="line">import android.view.View;</span><br><span class="line">import android.view.ViewGroup;</span><br><span class="line">import android.widget.BaseAdapter;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">public abstract class SectionedBaseAdapter extends BaseAdapter implements PinnedHeaderListView.PinnedSectionedHeaderAdapter &#123;</span><br><span class="line"></span><br><span class="line">    private static int HEADER_VIEW_TYPE = 0;</span><br><span class="line">    private static int ITEM_VIEW_TYPE = 0;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Holds the calculated values of @&#123;link getPositionInSectionForPosition&#125;</span><br><span class="line">     */</span><br><span class="line">    private SparseArray&lt;Integer&gt; mSectionPositionCache;</span><br><span class="line">    /**</span><br><span class="line">     * Holds the calculated values of @&#123;link getSectionForPosition&#125;</span><br><span class="line">     */</span><br><span class="line">    private SparseArray&lt;Integer&gt; mSectionCache;</span><br><span class="line">    /**</span><br><span class="line">     * Holds the calculated values of @&#123;link getCountForSection&#125;</span><br><span class="line">     */</span><br><span class="line">    private SparseArray&lt;Integer&gt; mSectionCountCache;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Caches the item count</span><br><span class="line">     */</span><br><span class="line">    private int mCount;</span><br><span class="line">    /**</span><br><span class="line">     * Caches the section count</span><br><span class="line">     */</span><br><span class="line">    private int mSectionCount;</span><br><span class="line"></span><br><span class="line">    public SectionedBaseAdapter() &#123;</span><br><span class="line">        super();</span><br><span class="line">        mSectionCache = new SparseArray&lt;Integer&gt;();</span><br><span class="line">        mSectionPositionCache = new SparseArray&lt;Integer&gt;();</span><br><span class="line">        mSectionCountCache = new SparseArray&lt;Integer&gt;();</span><br><span class="line">        mCount = -1;</span><br><span class="line">        mSectionCount = -1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void notifyDataSetChanged() &#123;</span><br><span class="line">        mSectionCache.clear();</span><br><span class="line">        mSectionPositionCache.clear();</span><br><span class="line">        mSectionCountCache.clear();</span><br><span class="line">        mCount = -1;</span><br><span class="line">        mSectionCount = -1;</span><br><span class="line">        super.notifyDataSetChanged();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void notifyDataSetInvalidated() &#123;</span><br><span class="line">        mSectionCache.clear();</span><br><span class="line">        mSectionPositionCache.clear();</span><br><span class="line">        mSectionCountCache.clear();</span><br><span class="line">        mCount = -1;</span><br><span class="line">        mSectionCount = -1;</span><br><span class="line">        super.notifyDataSetInvalidated();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public final int getCount() &#123;</span><br><span class="line">        if (mCount &gt;= 0) &#123;</span><br><span class="line">            return mCount;</span><br><span class="line">        &#125;</span><br><span class="line">        int count = 0;</span><br><span class="line">        for (int i = 0; i &lt; internalGetSectionCount(); i++) &#123;</span><br><span class="line">            count += internalGetCountForSection(i);</span><br><span class="line">            count++; // for the header view</span><br><span class="line">        &#125;</span><br><span class="line">        mCount = count;</span><br><span class="line">        return count;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public final Object getItem(int position) &#123;</span><br><span class="line">        return getItem(getSectionForPosition(position), getPositionInSectionForPosition(position));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public final long getItemId(int position) &#123;</span><br><span class="line">        return getItemId(getSectionForPosition(position), getPositionInSectionForPosition(position));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public final View getView(int position, View convertView, ViewGroup parent) &#123;</span><br><span class="line">        if (isSectionHeader(position)) &#123;</span><br><span class="line">            return getSectionHeaderView(getSectionForPosition(position), convertView, parent);</span><br><span class="line">        &#125;</span><br><span class="line">        return getItemView(getSectionForPosition(position), getPositionInSectionForPosition(position), convertView, parent);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public final int getItemViewType(int position) &#123;</span><br><span class="line">        if (isSectionHeader(position)) &#123;</span><br><span class="line">            return getItemViewTypeCount() + getSectionHeaderViewType(getSectionForPosition(position));</span><br><span class="line">        &#125;</span><br><span class="line">        return getItemViewType(getSectionForPosition(position), getPositionInSectionForPosition(position));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public final int getViewTypeCount() &#123;</span><br><span class="line">        return getItemViewTypeCount() + getSectionHeaderViewTypeCount();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public final int getSectionForPosition(int position) &#123;</span><br><span class="line">        // first try to retrieve values from cache</span><br><span class="line">        Integer cachedSection = mSectionCache.get(position);</span><br><span class="line">        if (cachedSection != null) &#123;</span><br><span class="line">            return cachedSection;</span><br><span class="line">        &#125;</span><br><span class="line">        int sectionStart = 0;</span><br><span class="line">        for (int i = 0; i &lt; internalGetSectionCount(); i++) &#123;</span><br><span class="line">            int sectionCount = internalGetCountForSection(i);</span><br><span class="line">            int sectionEnd = sectionStart + sectionCount + 1;</span><br><span class="line">            if (position &gt;= sectionStart &amp;&amp; position &lt; sectionEnd) &#123;</span><br><span class="line">                mSectionCache.put(position, i);</span><br><span class="line">                return i;</span><br><span class="line">            &#125;</span><br><span class="line">            sectionStart = sectionEnd;</span><br><span class="line">        &#125;</span><br><span class="line">        return 0;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public int getPositionInSectionForPosition(int position) &#123;</span><br><span class="line">        // first try to retrieve values from cache</span><br><span class="line">        Integer cachedPosition = mSectionPositionCache.get(position);</span><br><span class="line">        if (cachedPosition != null) &#123;</span><br><span class="line">            return cachedPosition;</span><br><span class="line">        &#125;</span><br><span class="line">        int sectionStart = 0;</span><br><span class="line">        for (int i = 0; i &lt; internalGetSectionCount(); i++) &#123;</span><br><span class="line">            int sectionCount = internalGetCountForSection(i);</span><br><span class="line">            int sectionEnd = sectionStart + sectionCount + 1;</span><br><span class="line">            if (position &gt;= sectionStart &amp;&amp; position &lt; sectionEnd) &#123;</span><br><span class="line">                int positionInSection = position - sectionStart - 1;</span><br><span class="line">                mSectionPositionCache.put(position, positionInSection);</span><br><span class="line">                return positionInSection;</span><br><span class="line">            &#125;</span><br><span class="line">            sectionStart = sectionEnd;</span><br><span class="line">        &#125;</span><br><span class="line">        return 0;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public final boolean isSectionHeader(int position) &#123;</span><br><span class="line">        int sectionStart = 0;</span><br><span class="line">        for (int i = 0; i &lt; internalGetSectionCount(); i++) &#123;</span><br><span class="line">            if (position == sectionStart) &#123;</span><br><span class="line">                return true;</span><br><span class="line">            &#125; else if (position &lt; sectionStart) &#123;</span><br><span class="line">                return false;</span><br><span class="line">            &#125;</span><br><span class="line">            sectionStart += internalGetCountForSection(i) + 1;</span><br><span class="line">        &#125;</span><br><span class="line">        return false;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public int getItemViewType(int section, int position) &#123;</span><br><span class="line">        return ITEM_VIEW_TYPE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public int getItemViewTypeCount() &#123;</span><br><span class="line">        return 1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public int getSectionHeaderViewType(int section) &#123;</span><br><span class="line">        return HEADER_VIEW_TYPE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public int getSectionHeaderViewTypeCount() &#123;</span><br><span class="line">        return 1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public abstract Object getItem(int section, int position);</span><br><span class="line"></span><br><span class="line">    public abstract long getItemId(int section, int position);</span><br><span class="line"></span><br><span class="line">    public abstract int getSectionCount();</span><br><span class="line"></span><br><span class="line">    public abstract int getCountForSection(int section);</span><br><span class="line"></span><br><span class="line">    public abstract View getItemView(int section, int position, View convertView, ViewGroup parent);</span><br><span class="line"></span><br><span class="line">    public abstract View getSectionHeaderView(int section, View convertView, ViewGroup parent);</span><br><span class="line"></span><br><span class="line">    private int internalGetCountForSection(int section) &#123;</span><br><span class="line">        Integer cachedSectionCount = mSectionCountCache.get(section);</span><br><span class="line">        if (cachedSectionCount != null) &#123;</span><br><span class="line">            return cachedSectionCount;</span><br><span class="line">        &#125;</span><br><span class="line">        int sectionCount = getCountForSection(section);</span><br><span class="line">        mSectionCountCache.put(section, sectionCount);</span><br><span class="line">        return sectionCount;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private int internalGetSectionCount() &#123;</span><br><span class="line">        if (mSectionCount &gt;= 0) &#123;</span><br><span class="line">            return mSectionCount;</span><br><span class="line">        &#125;</span><br><span class="line">        mSectionCount = getSectionCount();</span><br><span class="line">        return mSectionCount;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>这样我们就可以使用PinnedHeaderListView了，新建MainActivity,在布局文件中创建两个ListView。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">package com.example.qgx.gouwuche;</span><br><span class="line"></span><br><span class="line">import android.content.Context;</span><br><span class="line">import android.content.Intent;</span><br><span class="line">import android.support.v7.app.AppCompatActivity;</span><br><span class="line">import android.os.Bundle;</span><br><span class="line">import android.util.AttributeSet;</span><br><span class="line">import android.util.Log;</span><br><span class="line">import android.view.View;</span><br><span class="line">import android.widget.AbsListView;</span><br><span class="line">import android.widget.AdapterView;</span><br><span class="line">import android.widget.ListView;</span><br><span class="line"></span><br><span class="line">import com.example.qgx.gouwuche.mohu.BlurBehind;</span><br><span class="line">import com.example.qgx.gouwuche.mohu.OnBlurCompleteListener;</span><br><span class="line"></span><br><span class="line">public class MainActivity extends AppCompatActivity &#123;</span><br><span class="line"></span><br><span class="line">    ListView leftListview;</span><br><span class="line"></span><br><span class="line">    PinnedHeaderListView pinnedListView;</span><br><span class="line">    private boolean isScroll = true;</span><br><span class="line">    private LeftListAdapter adapter;</span><br><span class="line"></span><br><span class="line">    private String[] a = new String[100];</span><br><span class="line">    private String[] leftStr = new String[]&#123;&quot;面食类&quot;, &quot;盖饭&quot;, &quot;寿司&quot;, &quot;烧烤&quot;, &quot;酒水&quot;, &quot;凉菜&quot;, &quot;小吃&quot;, &quot;粥&quot;, &quot;休闲&quot;,&quot;1&quot;,&quot;2&quot;,&quot;3&quot;&#125;;</span><br><span class="line">    private boolean[] flagArray = &#123;true, false, false, false, false, false, false, false, false, false, false, false&#125;;</span><br><span class="line">    private String[][] rightStr = new String[][]&#123;&#123;&quot;热干面&quot;, &quot;臊子面&quot;, &quot;烩面&quot;&#125;,</span><br><span class="line">            &#123;&quot;番茄鸡蛋&quot;, &quot;红烧排骨&quot;, &quot;农家小炒肉&quot;&#125;,</span><br><span class="line">            &#123;&quot;芝士&quot;, &quot;丑小丫&quot;, &quot;金枪鱼&quot;&#125;, &#123;&quot;羊肉串&quot;, &quot;烤鸡翅&quot;, &quot;烤羊排&quot;&#125;, &#123;&quot;长城干红&quot;, &quot;燕京鲜啤&quot;, &quot;青岛鲜啤&quot;&#125;,</span><br><span class="line">            &#123;&quot;拌粉丝&quot;, &quot;大拌菜&quot;, &quot;菠菜花生&quot;&#125;, &#123;&quot;小食组&quot;, &quot;紫薯&quot;&#125;,</span><br><span class="line">            &#123;&quot;小米粥&quot;, &quot;大米粥&quot;, &quot;南瓜粥&quot;, &quot;玉米粥&quot;, &quot;紫米粥&quot;&#125;, &#123;&quot;儿童小汽车&quot;, &quot;悠悠球&quot;, &quot;熊大&quot;, &quot; 熊二&quot;, &quot;光头强&quot;&#125;,&#123;&quot;热干面&quot;, &quot;臊子面&quot;, &quot;烩面&quot;&#125;,</span><br><span class="line">            &#123;&quot;番茄鸡蛋&quot;, &quot;红烧排骨&quot;, &quot;农家小炒肉&quot;&#125;,</span><br><span class="line">            &#123;&quot;芝士&quot;, &quot;丑小丫&quot;, &quot;金枪鱼&quot;&#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void onCreate(Bundle savedInstanceState) &#123;</span><br><span class="line">        super.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">       leftListview =findViewById(R.id.left_listview);</span><br><span class="line">        pinnedListView = (PinnedHeaderListView) findViewById(R.id.pinnedListView);</span><br><span class="line">        final MainSectionedAdapter sectionedAdapter = new MainSectionedAdapter(this, leftStr, rightStr, a);</span><br><span class="line"></span><br><span class="line">        pinnedListView.setAdapter(sectionedAdapter);</span><br><span class="line"></span><br><span class="line">        adapter = new LeftListAdapter(this, leftStr, flagArray);</span><br><span class="line">        leftListview.setAdapter(adapter);</span><br><span class="line">        leftListview.setOnItemClickListener(new AdapterView.OnItemClickListener() &#123;</span><br><span class="line">            @Override</span><br><span class="line"></span><br><span class="line">            public void onItemClick(AdapterView&lt;?&gt; arg0, View view, int position, long arg3) &#123;</span><br><span class="line">                //String[] a = sectionedAdapter.getA();</span><br><span class="line">//                Log.i(&quot;123&quot;, &quot;onCreate: &quot;+a[0]+a[1]+a[2]);</span><br><span class="line">                isScroll = false;</span><br><span class="line">                for (int i = 0; i &lt; leftStr.length; i++) &#123;</span><br><span class="line">                    if (i == position) &#123;</span><br><span class="line">                        flagArray[i] = true;</span><br><span class="line">                    &#125; else &#123;</span><br><span class="line">                        flagArray[i] = false;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                adapter.notifyDataSetChanged();</span><br><span class="line">                int rightSection = 0;</span><br><span class="line">                for (int i = 0; i &lt; position; i++) &#123;</span><br><span class="line">                    rightSection += sectionedAdapter.getCountForSection(i) + 1;</span><br><span class="line">                &#125;</span><br><span class="line">                pinnedListView.setSelection(rightSection);</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        pinnedListView.setOnScrollListener(new AbsListView.OnScrollListener() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void onScrollStateChanged(AbsListView arg0, int scrollState) &#123;</span><br><span class="line">                switch (scrollState) &#123;</span><br><span class="line">                    // 当不滚动时</span><br><span class="line">                    case AbsListView.OnScrollListener.SCROLL_STATE_IDLE:</span><br><span class="line">                        // 判断滚动到底部</span><br><span class="line">                        if (pinnedListView.getLastVisiblePosition() == (pinnedListView.getCount() - 1)) &#123;</span><br><span class="line">                            leftListview.setSelection(ListView.FOCUS_DOWN);</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                        // 判断滚动到顶部</span><br><span class="line">                        if (pinnedListView.getFirstVisiblePosition() == 0) &#123;</span><br><span class="line">                            leftListview.setSelection(0);</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                        break;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            int y = 0;</span><br><span class="line">            int x = 0;</span><br><span class="line">            int z = 0;</span><br><span class="line"></span><br><span class="line">            @Override</span><br><span class="line">            public void onScroll(AbsListView view, int firstVisibleItem, int visibleItemCount, int totalItemCount) &#123;</span><br><span class="line">                if (isScroll) &#123;</span><br><span class="line">                    for (int i = 0; i &lt; rightStr.length; i++) &#123;</span><br><span class="line">                        if (i == sectionedAdapter.getSectionForPosition(pinnedListView.getFirstVisiblePosition())) &#123;</span><br><span class="line">                            flagArray[i] = true;</span><br><span class="line">                            x = i;</span><br><span class="line">                        &#125; else &#123;</span><br><span class="line">                            flagArray[i] = false;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    if (x != y) &#123;</span><br><span class="line">                        adapter.notifyDataSetChanged();</span><br><span class="line">                        y = x;</span><br><span class="line">                        if (y == leftListview.getLastVisiblePosition()) &#123;</span><br><span class="line">//                            z = z + 3;</span><br><span class="line">                            leftListview.setSelection(z);</span><br><span class="line">                        &#125;</span><br><span class="line">                        if (x == leftListview.getFirstVisiblePosition()) &#123;</span><br><span class="line">//                            z = z - 1;</span><br><span class="line">                            leftListview.setSelection(z);</span><br><span class="line">                        &#125;</span><br><span class="line">                        if (firstVisibleItem + visibleItemCount == totalItemCount - 1) &#123;</span><br><span class="line">                            leftListview.setSelection(ListView.FOCUS_DOWN);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; else &#123;</span><br><span class="line">                    isScroll = true;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void onDestroy() &#123;</span><br><span class="line"></span><br><span class="line">        super.onDestroy();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void zongjie(View view) &#123;</span><br><span class="line">        BlurBehind.getInstance().execute(MainActivity.this, new OnBlurCompleteListener() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void onBlurComplete() &#123;</span><br><span class="line">                Intent intent = new Intent(MainActivity.this,gouwucheActivity.class);</span><br><span class="line">                Bundle b=new Bundle();</span><br><span class="line">                b.putStringArray(&quot;A&quot;, a);</span><br><span class="line">                intent.putExtras(b);</span><br><span class="line">                startActivity(intent);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>MainActivity的布局文件如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</span><br><span class="line">    android:layout_width=&quot;match_parent&quot;</span><br><span class="line">    android:layout_height=&quot;match_parent&quot;</span><br><span class="line">    android:background=&quot;#606364&quot;</span><br><span class="line">    android:orientation=&quot;vertical&quot;&gt;</span><br><span class="line">&lt;LinearLayout</span><br><span class="line">    android:layout_width=&quot;match_parent&quot;</span><br><span class="line">    android:layout_height=&quot;460dp&quot;</span><br><span class="line">    android:orientation=&quot;horizontal&quot;&gt;</span><br><span class="line">    &lt;ListView</span><br><span class="line">        android:id=&quot;@+id/left_listview&quot;</span><br><span class="line">        android:layout_width=&quot;0dp&quot;</span><br><span class="line">        android:layout_height=&quot;match_parent&quot;</span><br><span class="line">        android:layout_weight=&quot;2&quot;</span><br><span class="line">        android:scrollbars=&quot;none&quot;</span><br><span class="line">        android:divider=&quot;@null&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;/ListView&gt;</span><br><span class="line"></span><br><span class="line">    &lt;com.example.qgx.gouwuche.PinnedHeaderListView</span><br><span class="line">        android:id=&quot;@+id/pinnedListView&quot;</span><br><span class="line">        android:layout_width=&quot;0dp&quot;</span><br><span class="line">        android:layout_height=&quot;match_parent&quot;</span><br><span class="line">        android:layout_marginLeft=&quot;10dp&quot;</span><br><span class="line">        android:layout_weight=&quot;5&quot;</span><br><span class="line">        android:background=&quot;@android:color/white&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;/com.example.qgx.gouwuche.PinnedHeaderListView&gt;</span><br><span class="line">&lt;/LinearLayout&gt;</span><br><span class="line"></span><br><span class="line">    &lt;RelativeLayout</span><br><span class="line">        android:id=&quot;@+id/car_rl&quot;</span><br><span class="line">        android:layout_width=&quot;match_parent&quot;</span><br><span class="line">        android:layout_height=&quot;50dp&quot;</span><br><span class="line">        android:layout_gravity=&quot;bottom&quot;</span><br><span class="line">        android:background=&quot;#454545&quot;&gt;</span><br><span class="line"></span><br><span class="line">        &lt;TextView</span><br><span class="line">            android:id=&quot;@+id/car_nonselect&quot;</span><br><span class="line">            android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">            android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">            android:layout_centerVertical=&quot;true&quot;</span><br><span class="line">            android:layout_marginLeft=&quot;80dp&quot;</span><br><span class="line">            android:text=&quot;未选购商品&quot;</span><br><span class="line">            android:textColor=&quot;#a8a8a8&quot;</span><br><span class="line">            android:textSize=&quot;13sp&quot;</span><br><span class="line">            android:textStyle=&quot;bold&quot;/&gt;</span><br><span class="line"></span><br><span class="line">        &lt;LinearLayout</span><br><span class="line">            android:id=&quot;@+id/amount_container&quot;</span><br><span class="line">            android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">            android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">            android:layout_centerVertical=&quot;true&quot;</span><br><span class="line">            android:layout_marginLeft=&quot;80dp&quot;</span><br><span class="line">            android:gravity=&quot;center_vertical&quot;</span><br><span class="line">            android:orientation=&quot;vertical&quot;</span><br><span class="line">            android:visibility=&quot;gone&quot;&gt;</span><br><span class="line"></span><br><span class="line">            &lt;TextView</span><br><span class="line">                android:id=&quot;@+id/tv_amount&quot;</span><br><span class="line">                android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">                android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">                android:textColor=&quot;#fff&quot;</span><br><span class="line">                android:textSize=&quot;18sp&quot;</span><br><span class="line">                android:textStyle=&quot;bold&quot;/&gt;</span><br><span class="line"></span><br><span class="line">            &lt;TextView</span><br><span class="line">                android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">                android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">                android:text=&quot;另需配送费¥4元&quot;</span><br><span class="line">                android:textColor=&quot;#fff&quot;</span><br><span class="line">                android:textSize=&quot;10sp&quot;/&gt;</span><br><span class="line">        &lt;/LinearLayout&gt;</span><br><span class="line"></span><br><span class="line">        &lt;TextView</span><br><span class="line">            android:id=&quot;@+id/car_limit&quot;</span><br><span class="line">            android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">            android:layout_height=&quot;match_parent&quot;</span><br><span class="line">            android:layout_alignParentRight=&quot;true&quot;</span><br><span class="line">            android:background=&quot;#535353&quot;</span><br><span class="line">            android:gravity=&quot;center&quot;</span><br><span class="line">            android:paddingLeft=&quot;8dp&quot;</span><br><span class="line">            android:paddingRight=&quot;8dp&quot;</span><br><span class="line">            android:text=&quot;确认下单&quot;</span><br><span class="line">            android:textColor=&quot;#a8a8a8&quot;</span><br><span class="line">            android:textSize=&quot;16sp&quot;</span><br><span class="line">            android:textStyle=&quot;bold&quot;/&gt;</span><br><span class="line">        &lt;ImageView</span><br><span class="line">            android:id=&quot;@+id/iv_shop_car&quot;</span><br><span class="line">            android:onClick=&quot;zongjie&quot;</span><br><span class="line">            android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">            android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">            android:layout_marginBottom=&quot;8dp&quot;</span><br><span class="line">            android:layout_marginLeft=&quot;-50dp&quot;</span><br><span class="line">            android:src=&quot;@drawable/shop_car_empty&quot;/&gt;</span><br><span class="line">    &lt;/RelativeLayout&gt;</span><br><span class="line"></span><br><span class="line">&lt;/LinearLayout&gt;</span><br></pre></td></tr></table></figure></p>
<p>分别为左侧ListView和右侧ListView创建Adapter。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">package com.example.qgx.gouwuche;</span><br><span class="line"></span><br><span class="line">import android.content.Context;</span><br><span class="line">import android.graphics.Color;</span><br><span class="line">import android.view.LayoutInflater;</span><br><span class="line">import android.view.View;</span><br><span class="line">import android.view.ViewGroup;</span><br><span class="line">import android.widget.BaseAdapter;</span><br><span class="line">import android.widget.TextView;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 基本功能：左侧Adapter</span><br><span class="line"> * 创建：王杰</span><br><span class="line"> * 创建时间：16/4/14</span><br><span class="line"> * 邮箱：w489657152@gmail.com</span><br><span class="line"> */</span><br><span class="line">public class LeftListAdapter extends BaseAdapter &#123;</span><br><span class="line">    private String[] leftStr;</span><br><span class="line">    boolean[] flagArray;</span><br><span class="line">    private Context context;</span><br><span class="line"></span><br><span class="line">    public LeftListAdapter(Context context, String[] leftStr, boolean[] flagArray) &#123;</span><br><span class="line">        this.leftStr = leftStr;</span><br><span class="line">        this.context = context;</span><br><span class="line">        this.flagArray = flagArray;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public int getCount() &#123;</span><br><span class="line">        return leftStr.length;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public Object getItem(int arg0) &#123;</span><br><span class="line">        return leftStr[arg0];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public long getItemId(int arg0) &#123;</span><br><span class="line">        return arg0;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public View getView(int arg0, View arg1, ViewGroup arg2) &#123;</span><br><span class="line">        Holder holder = null;</span><br><span class="line">        if (arg1 == null) &#123;</span><br><span class="line">            holder = new Holder();</span><br><span class="line">            arg1 = LayoutInflater.from(context).inflate(R.layout.left_list_item, null);</span><br><span class="line">            holder.left_list_item = (TextView) arg1.findViewById(R.id.left_list_item);</span><br><span class="line">            arg1.setTag(holder);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            holder = (Holder) arg1.getTag();</span><br><span class="line">        &#125;</span><br><span class="line">        holder.updataView(arg0);</span><br><span class="line">        return arg1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private class Holder &#123;</span><br><span class="line">        private TextView left_list_item;</span><br><span class="line"></span><br><span class="line">        public void updataView(final int position) &#123;</span><br><span class="line">            left_list_item.setText(leftStr[position]);</span><br><span class="line">            if (flagArray[position]) &#123;</span><br><span class="line">                left_list_item.setBackgroundColor(Color.rgb(255, 255, 255));</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                left_list_item.setBackgroundColor(Color.TRANSPARENT);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line">package com.example.qgx.gouwuche;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">import android.content.Context;</span><br><span class="line">import android.util.Log;</span><br><span class="line">import android.view.LayoutInflater;</span><br><span class="line">import android.view.View;</span><br><span class="line">import android.view.View.OnClickListener;</span><br><span class="line">import android.view.ViewGroup;</span><br><span class="line">import android.widget.Button;</span><br><span class="line">import android.widget.LinearLayout;</span><br><span class="line">import android.widget.RelativeLayout;</span><br><span class="line">import android.widget.TextView;</span><br><span class="line">import android.widget.Toast;</span><br><span class="line"></span><br><span class="line">public class MainSectionedAdapter extends SectionedBaseAdapter &#123;</span><br><span class="line"></span><br><span class="line">    private Context mContext;</span><br><span class="line">    private String[] leftStr;</span><br><span class="line">    private String[][] rightStr;</span><br><span class="line">    private int count1=0;</span><br><span class="line">    private int[][] count= new int[100][100];</span><br><span class="line">    private String[] a = new String[100];</span><br><span class="line"></span><br><span class="line">    public MainSectionedAdapter(Context context, String[] leftStr, String[][] rightStr, String[] a) &#123;</span><br><span class="line">        this.mContext = context;</span><br><span class="line">        this.leftStr = leftStr;</span><br><span class="line">        this.rightStr = rightStr;</span><br><span class="line">        this.a = a;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public Object getItem(int section, int position) &#123;</span><br><span class="line">        return rightStr[section][position];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String[] getA()&#123;</span><br><span class="line">        return a;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    @Override</span><br><span class="line">    public long getItemId(int section, int position) &#123;</span><br><span class="line">        return position;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public int getSectionCount() &#123;</span><br><span class="line">        return leftStr.length;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public int getCountForSection(int section) &#123;</span><br><span class="line">        return rightStr[section].length;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public View getItemView(final int section, final int position, final View convertView, final ViewGroup parent) &#123;</span><br><span class="line">        RelativeLayout layout = null;</span><br><span class="line">        if (convertView == null) &#123;</span><br><span class="line">            LayoutInflater inflator = (LayoutInflater) parent.getContext()</span><br><span class="line">                    .getSystemService(Context.LAYOUT_INFLATER_SERVICE);</span><br><span class="line">            layout = (RelativeLayout) inflator.inflate(R.layout.right_list_item, null);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            layout = (RelativeLayout) convertView;</span><br><span class="line">        &#125;</span><br><span class="line">        ((TextView) layout.findViewById(R.id.textItem)).setText(rightStr[section][position]);</span><br><span class="line">        ((TextView) layout.findViewById(R.id.count)).setText(count+&quot;&quot;);</span><br><span class="line"></span><br><span class="line">         layout.findViewById(R.id.add).setOnClickListener(</span><br><span class="line">                       new OnClickListener() &#123;</span><br><span class="line">                           @Override</span><br><span class="line">                           public void onClick(View view) &#123;</span><br><span class="line">                               //TextView  t =getItemView(section,position,convertView,parent).findViewById(R.id.count);</span><br><span class="line">                              count[section][position]++;</span><br><span class="line">                              Toast.makeText(mContext, rightStr[section][position]+count[section][position], Toast.LENGTH_SHORT).show();</span><br><span class="line"></span><br><span class="line">                              a[count1]=rightStr[section][position];</span><br><span class="line">                              count1++;</span><br><span class="line">                               Log.i(&quot;123&quot;, &quot;onClick: &quot;+a[0]+a[1]+a[2]);</span><br><span class="line">                           &#125;</span><br><span class="line">                       &#125;</span><br><span class="line">               );</span><br><span class="line">        layout.setOnClickListener(new OnClickListener() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void onClick(View arg0) &#123;</span><br><span class="line">                Toast.makeText(mContext, rightStr[section][position], Toast.LENGTH_SHORT).show();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        return layout;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public View getSectionHeaderView(int section, View convertView, ViewGroup parent) &#123;</span><br><span class="line">        LinearLayout layout = null;</span><br><span class="line">        if (convertView == null) &#123;</span><br><span class="line">            LayoutInflater inflator = (LayoutInflater) parent.getContext()</span><br><span class="line">                    .getSystemService(Context.LAYOUT_INFLATER_SERVICE);</span><br><span class="line">            layout = (LinearLayout) inflator.inflate(R.layout.header_item, null);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            layout = (LinearLayout) convertView;</span><br><span class="line">        &#125;</span><br><span class="line">        layout.setClickable(false);</span><br><span class="line">        ((TextView) layout.findViewById(R.id.textItem)).setText(leftStr[section]);</span><br><span class="line">        return layout;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>三个ListView用到的Item。<br><strong>header_item.xml</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><br><span class="line"></span><br><span class="line">&lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</span><br><span class="line">    android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">    android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">    android:background=&quot;@color/gray_light&quot;</span><br><span class="line">    android:orientation=&quot;horizontal&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;TextView</span><br><span class="line">        android:id=&quot;@+id/textItem&quot;</span><br><span class="line">        android:layout_marginLeft=&quot;@dimen/dp10&quot;</span><br><span class="line">        android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">        android:layout_height=&quot;@dimen/dp30&quot;</span><br><span class="line">        android:layout_gravity=&quot;center_vertical&quot;</span><br><span class="line">        android:gravity=&quot;center_vertical&quot;</span><br><span class="line">        android:paddingLeft=&quot;@dimen/dp6&quot;</span><br><span class="line">        android:textColor=&quot;@color/black&quot; /&gt;</span><br><span class="line">&lt;/LinearLayout&gt;</span><br></pre></td></tr></table></figure></p>
<p><strong>left_list_item.xml</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</span><br><span class="line">    android:layout_width=&quot;match_parent&quot;</span><br><span class="line">    android:layout_height=&quot;match_parent&quot;</span><br><span class="line"> android:background=&quot;@color/gray_light&quot;</span><br><span class="line">    android:orientation=&quot;vertical&quot; &gt;</span><br><span class="line">    </span><br><span class="line"> &lt;TextView </span><br><span class="line">     android:id=&quot;@+id/left_list_item&quot;</span><br><span class="line">     android:layout_width=&quot;match_parent&quot;</span><br><span class="line">     android:layout_height=&quot;@dimen/dp60&quot;</span><br><span class="line">     android:padding=&quot;@dimen/dp12&quot;</span><br><span class="line">  android:gravity=&quot;center_vertical&quot;</span><br><span class="line">  android:textColor=&quot;@color/black&quot;/&gt;</span><br><span class="line">    </span><br><span class="line">&lt;/LinearLayout&gt;</span><br></pre></td></tr></table></figure></p>
<p><strong>right_list_item.xml</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;RelativeLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</span><br><span class="line">    android:layout_width=&quot;match_parent&quot;</span><br><span class="line">    android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">    android:background=&quot;@color/white&quot;</span><br><span class="line">    android:padding=&quot;@dimen/dp6&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;ImageView</span><br><span class="line">        android:id=&quot;@+id/imageItem&quot;</span><br><span class="line">        android:layout_width=&quot;@dimen/dp50&quot;</span><br><span class="line">        android:layout_height=&quot;@dimen/dp50&quot;</span><br><span class="line">        android:scaleType=&quot;fitXY&quot;</span><br><span class="line">        android:src=&quot;@drawable/pic&quot;/&gt;</span><br><span class="line"></span><br><span class="line">    &lt;TextView</span><br><span class="line">        android:id=&quot;@+id/textItem&quot;</span><br><span class="line">        android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">        android:layout_height=&quot;@dimen/dp50&quot;</span><br><span class="line">        android:gravity=&quot;center_vertical&quot;</span><br><span class="line">        android:paddingLeft=&quot;@dimen/dp6&quot;</span><br><span class="line">        android:layout_toRightOf=&quot;@+id/imageItem&quot;</span><br><span class="line">        android:textColor=&quot;@color/black&quot; /&gt;</span><br><span class="line">&lt;/RelativeLayout&gt;</span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/07/20/Servlet 的线程安全问题/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Qgx">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="qin12的学习博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/07/20/Servlet 的线程安全问题/" itemprop="url">
                  javaweb (二)
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-07-20 12:10:37" itemprop="dateCreated datePublished" datetime="2018-07-20T12:10:37+08:00">2018-07-20</time>
            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/javaEE/" itemprop="url" rel="index"><span itemprop="name">javaEE</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="Servlet-的线程安全问题"><a href="#Servlet-的线程安全问题" class="headerlink" title="Servlet 的线程安全问题"></a>Servlet 的线程安全问题</h3><ul>
<li>当多个客户端并发访问同一个Servlet时，web服务器会为每一个客户端的访问请求创建一个线程，并在这个线程上调用Servlet的service方法，因此service方法内如果访问了同一个资源的话，就有可能引发线程安全问题。例如下面的代码：</li>
<li>不存在线程安全问题的代码：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">import javax.servlet.ServletException;</span><br><span class="line">import javax.servlet.annotation.WebServlet;</span><br><span class="line">import javax.servlet.http.HttpServlet;</span><br><span class="line">import javax.servlet.http.HttpServletRequest;</span><br><span class="line">import javax.servlet.http.HttpServletResponse;</span><br><span class="line">import java.io.IOException;</span><br><span class="line">@WebServlet(name = &quot;Servlet&quot;)</span><br><span class="line">public class ServletDemo3 extends HttpServlet &#123;</span><br><span class="line">    protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException &#123;</span><br><span class="line">doGet(request,response);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException &#123;</span><br><span class="line">/** * 当多线程并发访问这个方法里面的代码时，会存在线程安全问题吗</span><br><span class="line">  * i变量被多个线程并发访问，但是没有线程安全问题，因为i是doGet方法里面的局部变量，</span><br><span class="line">  * 当有多个线程并发访问doGet方法时，每一个线程里面都有自己的i变量，</span><br><span class="line">  * 各个线程操作的都是自己的i变量，所以不存在线程安全问题</span><br><span class="line">  * 多线程并发访问某一个方法的时候，如果在方法内部定义了一些资源(变量，集合等)</span><br><span class="line">  * 那么每一个线程都有这些东西，所以就不存在线程安全问题了</span><br><span class="line">  */</span><br><span class="line">        int i=1;</span><br><span class="line">        i++;        response.getWriter().write(i+&quot;&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>存在线程安全问题的代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">import javax.servlet.ServletException;</span><br><span class="line">import javax.servlet.annotation.WebServlet;</span><br><span class="line">import javax.servlet.http.HttpServlet;</span><br><span class="line">import javax.servlet.http.HttpServletRequest;</span><br><span class="line">import javax.servlet.http.HttpServletResponse;</span><br><span class="line">import java.io.IOException;</span><br><span class="line">@WebServlet(name = &quot;ServletDemo4&quot;)</span><br><span class="line">public class ServletDemo4 extends HttpServlet &#123;</span><br><span class="line">    int i=1;</span><br><span class="line">    protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException &#123;</span><br><span class="line">doGet(request,response);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException &#123;</span><br><span class="line">        i++;</span><br><span class="line">        try &#123;</span><br><span class="line">             Thread.sleep(1000);</span><br><span class="line">            &#125; catch (InterruptedException e) &#123;</span><br><span class="line">             e.printStackTrace();</span><br><span class="line">            &#125;    response.getWriter().write(i+&quot;&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>　把i定义成全局变量，当多个线程并发访问变量i时，就会存在线程安全问题了，如下图所示：同时开启两个浏览器模拟并发访问同一个Servlet，本来正常来说，第一个浏览器应该看到2，而第二个浏览器应该看到3的，结果两个浏览器都看到了3，这就不正常。<br>　线程安全问题只存在多个线程并发操作同一个资源的情况下，所以在编写Servlet的时候，如果并发访问某一个资源(变量，集合等)，就会存在线程安全问题，那么该如何解决这个问题呢？<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">public void doGet(HttpServletRequest request, HttpServletResponse response)</span><br><span class="line">             throws ServletException, IOException &#123;</span><br><span class="line">         /**</span><br><span class="line">          * 加了synchronized后，并发访问i时就不存在线程安全问题了，</span><br><span class="line">          * 为什么加了synchronized后就没有线程安全问题了呢？</span><br><span class="line">          * 假如现在有一个线程访问Servlet对象，那么它就先拿到了Servlet对象的那把锁</span><br><span class="line">          * 等到它执行完之后才会把锁还给Servlet对象，由于是它先拿到了Servlet对象的那把锁，</span><br><span class="line">          * 所以当有别的线程来访问这个Servlet对象时，由于锁已经被之前的线程拿走了，后面的线程只能排队等候了</span><br><span class="line">          * </span><br><span class="line">          */</span><br><span class="line">         synchronized (this) &#123;//在java中，每一个对象都有一把锁，这里的this指的就是Servlet对象</span><br><span class="line">             i++;</span><br><span class="line">             try &#123;</span><br><span class="line">                 Thread.sleep(1000*4);</span><br><span class="line">            &#125; catch (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">             response.getWriter().write(i+&quot;&quot;);</span><br><span class="line">         &#125;</span><br><span class="line">         </span><br><span class="line">     &#125;</span><br></pre></td></tr></table></figure></p>
<p>现在这种做法是给Servlet对象加了一把锁，保证任何时候都只有一个线程在访问该Servlet对象里面的资源，这样就不存在线程安全问题了，如下图所示：<br><img src="/img/线程结果.png" alt=""><br>这种做法虽然解决了线程安全问题，但是编写Servlet却万万不能用这种方式处理线程安全问题，假如有9999个人同时访问这个Servlet，那么这9999个人必须按先后顺序排队轮流访问。<br>针对Servlet的线程安全问题，Sun公司是提供有解决方案的：让Servlet去实现一个SingleThreadModel接口，如果某个Servlet实现了SingleThreadModel接口，那么Servlet引擎将以单线程模式来调用其service方法。<br>查看Sevlet的API可以看到，SingleThreadModel接口中没有定义任何方法和常量，在Java中，把没有定义任何方法和常量的接口称之为标记接口，经常看到的一个最典型的标记接口就是”Serializable”，这个接口也是没有定义任何方法和常量的，标记接口在Java中有什么用呢？主要作用就是给某个对象打上一个标志，告诉JVM，这个对象可以做什么，比如实现了”Serializable”接口的类的对象就可以被序列化，还有一个”Cloneable”接口，这个也是一个标记接口，在默认情况下，Java中的对象是不允许被克隆的，就像现实生活中的人一样，不允许克隆，但是只要实现了”Cloneable”接口，那么对象就可以被克隆了。</p>
<p>　　让Servlet实现了SingleThreadModel接口，只要在Servlet类的定义中增加实现SingleThreadModel接口的声明即可。<br>　　对于实现了SingleThreadModel接口的Servlet，Servlet引擎仍然支持对该Servlet的多线程并发访问，其采用的方式是产生多个Servlet实例对象，并发的每个线程分别调用一个独立的Servlet实例对象。<br>　　实现SingleThreadModel接口并不能真正解决Servlet的线程安全问题，因为Servlet引擎会创建多个Servlet实例对象，而真正意义上解决多线程安全问题是指一个Servlet实例对象被多个线程同时调用的问题。事实上，在Servlet API 2.4中，已经将SingleThreadModel标记为Deprecated（过时的）。  </p>
<ul>
<li>实现 SingleThreadModel 接口（已过时）</li>
<li>同步对共享数据的操作<br>　　使用synchronized 关键字能保证一次只有一个线程可以访问被保护的区段，在本论文中的Servlet可以通过同步块操作来保证线程的安全。</li>
<li>避免使用实例变量—-最佳选择。<br>　　本实例中的线程安全问题是由实例变量造成的，只要在Servlet里面的任何方法里面都不使用实例变量，那么该Servlet就是线程安全的。</li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/07/20/装饰者模式/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Qgx">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="qin12的学习博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/07/20/装饰者模式/" itemprop="url">
                  装饰者模式
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-07-20 12:10:37" itemprop="dateCreated datePublished" datetime="2018-07-20T12:10:37+08:00">2018-07-20</time>
            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/设计模式/" itemprop="url" rel="index"><span itemprop="name">设计模式</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="装饰者模式"><a href="#装饰者模式" class="headerlink" title="装饰者模式"></a>装饰者模式</h3><h4 id="定义："><a href="#定义：" class="headerlink" title="定义："></a>定义：</h4><pre><code>在不必改变原类文件和原类使用的继承的情况下，动态地扩展一个对象的功能。
它是通过创建一个包装对象，也就是用装饰来包裹真实的对象来实现。
</code></pre><h4 id="角色："><a href="#角色：" class="headerlink" title="角色："></a>角色：</h4><p>######抽象构件角色（Project）：<br>给出一个接口，以规范准备接收附加责任的对象。</p>
<h5 id="具体构件角色（Employe）："><a href="#具体构件角色（Employe）：" class="headerlink" title="具体构件角色（Employe）："></a>具体构件角色（Employe）：</h5><p>定义一个将要接收附加责任的类。</p>
<h5 id="装饰角色（Manager）："><a href="#装饰角色（Manager）：" class="headerlink" title="装饰角色（Manager）："></a>装饰角色（Manager）：</h5><p>持有一个构件对象的实例，并定义一个与抽象构件接口一致的接口。</p>
<h5 id="具体装饰角色（ManagerA、ManagerB）："><a href="#具体装饰角色（ManagerA、ManagerB）：" class="headerlink" title="具体装饰角色（ManagerA、ManagerB）："></a>具体装饰角色（ManagerA、ManagerB）：</h5><p>负责给构件对象“贴上”附加的责任。</p>
<h4 id="示例："><a href="#示例：" class="headerlink" title="示例："></a>示例：</h4><h4 id="公共接口："><a href="#公共接口：" class="headerlink" title="公共接口："></a>公共接口：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">public interface Person &#123;  </span><br><span class="line">    void eat();  </span><br><span class="line">&#125;</span><br><span class="line">被装饰对象：</span><br><span class="line">public class OldPerson implements Person &#123;  </span><br><span class="line">    @Override  </span><br><span class="line">    public void eat() &#123;  </span><br><span class="line">        System.out.println(&quot;吃饭&quot;);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125; </span><br><span class="line">装饰对象：</span><br><span class="line">public class NewPerson implements Person &#123;  </span><br><span class="line">    private OldPerson p;  </span><br><span class="line"></span><br><span class="line">    NewPerson(OldPerson p) &#123;  </span><br><span class="line">        this.p = p;  </span><br><span class="line">    &#125;  </span><br><span class="line"></span><br><span class="line">    @Override  </span><br><span class="line">    public void eat() &#123;  </span><br><span class="line">        System.out.println(&quot;生火&quot;);  </span><br><span class="line">        System.out.println(&quot;做饭&quot;);  </span><br><span class="line">        p.eat();  </span><br><span class="line">        System.out.println(&quot;刷碗&quot;);   </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>测试：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">public class PersonDemo &#123;  </span><br><span class="line">    public static void main(String[] args) &#123;  </span><br><span class="line">        OldPerson old = new OldPerson();  </span><br><span class="line">        //old.eat(); </span><br><span class="line">        NewPerson np = new NewPerson(old);  </span><br><span class="line">        np.eat();  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<pre><code>通过例子可以看到，没有改变原来的OldPerson类，同时也没有定义他的子类而实现了Person的扩展，这就是装饰者模式的作用。
</code></pre><h4 id="优点："><a href="#优点：" class="headerlink" title="优点："></a>优点：</h4><pre><code>1，使用装饰者模式比使用继承更加灵活，因为它选择通过一种动态的方式来扩展一个对象的功能，在运行时可以选择不同的装饰器，从而实现不同的行为。
2，通过使用不同的具体装饰类以及这些装饰类的排列组合，可以创造出很多不同行为的组合。可以使用多个具体装饰类来装饰同一对象，得到功能更为强大的对象。
3，具体构件类与具体装饰类可以独立变化，他能是低耦合的。用户可以根据需要来增加新的具体构件类和具体装饰类，在使用时再对其进行各种组合，原有代码无须改变，符合“开闭原则”。
</code></pre><h4 id="缺点："><a href="#缺点：" class="headerlink" title="缺点："></a>缺点：</h4><pre><code>1，会产生很多的小对象，增加了系统的复杂性
2，这种比继承更加灵活机动的特性，也同时意味着装饰模式比继承更加易于出错，排错也很困难，对于多次装饰的对象，调试时寻找错误可能需要逐级排查，较为烦琐。
</code></pre><h4 id="装饰者与适配者模式的区别："><a href="#装饰者与适配者模式的区别：" class="headerlink" title="装饰者与适配者模式的区别："></a>装饰者与适配者模式的区别：</h4><p>   1，适配器模式主要用来兼容那些不能在一起工作的类，使他们转化为可以兼容目标接口，虽然也可以实现和装饰者一样的增加新职责，但目的不在此。<br>        装饰者模式主要是给被装饰者增加新职责的。<br>   2，适配器模式是用新接口来调用原接口，原接口对新系统是不可见或者说不可用的。<br>        装饰者模式原封不动的使用原接口，系统对装饰的对象也通过原接口来完成使用。<br>   3，适配器是知道被适配者的详细情况的（就是那个类或那个接口）。<br>        装饰者只知道其接口是什么，至于其具体类型（是基类还是其他派生类）只有在运行期间才知道。</p>
<h4 id="装饰者和继承的区别："><a href="#装饰者和继承的区别：" class="headerlink" title="装饰者和继承的区别："></a>装饰者和继承的区别：</h4><h5 id="继承："><a href="#继承：" class="headerlink" title="继承："></a>继承：</h5><p>　　优点：代码结构清晰，而且实现简单<br>　　缺点：对于每一个的需要增强的类都要创建具体的子类来帮助其增强，这样会导致继承体系过于庞大。</p>
<h5 id="装饰者："><a href="#装饰者：" class="headerlink" title="装饰者："></a>装饰者：</h5><p>　　优点：内部可以通过多态技术对多个需要增强的类进行增强<br>       缺点：需要内部通过多态技术维护需要增强的类的实例。进而使得代码稍微复杂。</p>
<h5 id="使用场景："><a href="#使用场景：" class="headerlink" title="使用场景："></a>使用场景：</h5><pre><code>1，需要扩展一个类的功能，或给一个类添加附加职责。
2，需要动态的给一个对象添加功能，这些功能可能不明确或者暂时的，可以随时很方便的动态撤销掉。
3，需要增加由一些基本功能的排列组合而产生的非常大量的功能，从而使继承关系变的不现实。
      4. 当不能采用生成子类的方法进行扩充时。一种情况是，可能有大量独立的扩展，为支持每一种组合将产生大量的子类，使得子类数目呈爆炸性增长。另一种情况可能是因为类定义被隐藏，或类定义不能用于生成子类。
</code></pre>
          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/07/20/外观者模式/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Qgx">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="qin12的学习博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/07/20/外观者模式/" itemprop="url">
                  外观者模式
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-07-20 12:10:37" itemprop="dateCreated datePublished" datetime="2018-07-20T12:10:37+08:00">2018-07-20</time>
            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/设计模式/" itemprop="url" rel="index"><span itemprop="name">设计模式</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="外观者模式"><a href="#外观者模式" class="headerlink" title="外观者模式"></a>外观者模式</h3><h4 id="定义："><a href="#定义：" class="headerlink" title="定义："></a>定义：</h4><p>   为子系统中的一组接口提供一个一致的界面，Facade模式定义了一个高层接口，这个接口使得这一子系统更加容易使用。</p>
<h4 id="角色："><a href="#角色：" class="headerlink" title="角色："></a>角色：</h4><h5 id="1、外观-Facade-角色-："><a href="#1、外观-Facade-角色-：" class="headerlink" title="1、外观(Facade)角色 ："></a>1、外观(Facade)角色 ：</h5><pre><code>客户端可以调用这个角色的方法。此角色知晓相关子系统的功能和责任。在正常情况下，本角色会将所有从客户端发来的请求委派到相应的子系统去。
</code></pre><h5 id="2、子系统-SubSystem-角色-："><a href="#2、子系统-SubSystem-角色-：" class="headerlink" title="2、子系统(SubSystem)角色 ："></a>2、子系统(SubSystem)角色 ：</h5><pre><code>可以同时有一个或者多个子系统。每个子系统都不是一个单独的类，而是一个类的集合。每个子系统都可以被客户端直接调用，或者被外观角色调用。子系统并不知道外观角色的存在，对于子系统而言，外观角色仅仅是另外一个客户端而已。
</code></pre><h4 id="示例："><a href="#示例：" class="headerlink" title="示例："></a>示例：</h4><h5 id="1、子系统角色，由若干个类组成"><a href="#1、子系统角色，由若干个类组成" class="headerlink" title="1、子系统角色，由若干个类组成"></a>1、子系统角色，由若干个类组成</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">public class SubClass1 &#123;    </span><br><span class="line">    public void method1()&#123;</span><br><span class="line">        System.out.println(&quot;这是子系统类1中的方法1&quot;);</span><br><span class="line">    &#125;    </span><br><span class="line">    public void method2()&#123;</span><br><span class="line">        System.out.println(&quot;这是子系统类1中的方法2&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">public class SubClass2 &#123;    </span><br><span class="line">    public void method1()&#123;</span><br><span class="line">        System.out.println(&quot;这是子系统类2中的方法1&quot;);</span><br><span class="line">    &#125;    </span><br><span class="line">    public void method2()&#123;</span><br><span class="line">        System.out.println(&quot;这是子系统类2中的方法2&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">public class SubClass3 &#123;   </span><br><span class="line">    public void method1()&#123;</span><br><span class="line">        System.out.println(&quot;这是子系统类3中的方法1&quot;);</span><br><span class="line">    &#125;    </span><br><span class="line">    public void method2()&#123;</span><br><span class="line">        System.out.println(&quot;这是子系统类3中的方法2&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="2、外观角色类"><a href="#2、外观角色类" class="headerlink" title="2、外观角色类"></a>2、外观角色类</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">public class FacadeClass &#123;    </span><br><span class="line">    public void FacadeMethod()&#123;</span><br><span class="line">        SubClass1 s1 = new SubClass1();</span><br><span class="line">        s1.method1();</span><br><span class="line">        SubClass2 s2 = new SubClass2();</span><br><span class="line">        s2.method1();</span><br><span class="line">        SubClass3 s3 = new SubClass3();</span><br><span class="line">        s3.method1();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="3、客户端测试方法"><a href="#3、客户端测试方法" class="headerlink" title="3、客户端测试方法"></a>3、客户端测试方法</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public class ClientClass &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        FacadeClass fc = new FacadeClass();</span><br><span class="line">        fc.FacadeMethod();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Facade类其实相当于子系统中SubClass类的外观界面，有了这个Facade类，那么客户端就不需要亲自调用子系统中的那些具体实现的子类了，也不需要知道系统内部的实现细节，甚至都不需要知道这些子类的存在，客户端只需要跟Facade类交互就好了，从而更好地实现了客户端和子系统中具体类的解耦，让客户端更容易地使用系统。<br>        同时，这样定义一个Facade类可以有效地屏蔽内部的细节，免得客户端去调用Module类时，发现一些不需要它知道的方法。如上代码，我的所有子类中的方法二都是方法一调用的方法，是配合方法一的，他们不需要被客户端调用，而且具有一定的保密性，这样使用外观模式时就可以不被客户端知道。</p>
<h4 id="优点："><a href="#优点：" class="headerlink" title="优点："></a>优点：</h4><ul>
<li>实现了子系统与客户端之间的松耦合关系。</li>
<li>客户端屏蔽了子系统组件，减少了客户端所需处理的对象数目，并使得子系统使用起来更加容易。</li>
</ul>
<h4 id="适用场景："><a href="#适用场景：" class="headerlink" title="适用场景："></a>适用场景：</h4><ul>
<li>设计初期阶段，应该有意识的将不同层分离，层与层之间建立外观模式。</li>
<li>开发阶段，子系统越来越复杂，增加外观模式提供一个简单的调用接口。</li>
<li>维护一个大型遗留系统的时候，可能这个系统已经非常难以维护和扩展，但又包含非常重要的功能，为其开发一个外观类，以便新系统与其交互。</li>
</ul>
<h4 id="外观模式总结："><a href="#外观模式总结：" class="headerlink" title="外观模式总结："></a>外观模式总结：</h4><ul>
<li>1、外观模式为复杂子系统提供了一个简单接口，并不为子系统添加新的功能和行为。</li>
<li>2、外观模式实现了子系统与客户端之间的松耦合关系。 </li>
<li>3、外观模式没有封装子系统的类，只是提供了简单的接口。 如果应用需要，它并不限制客户使用子系统类。因此可以灵活的在系统易用性与通用性之间选择。</li>
<li>4、外观模式注重的是简化接口，它更多的时候是从架构的层次去看整个系统，而并非单个类的层次。 </li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/07/20/利用ServletContext对象读取资源文件/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Qgx">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="qin12的学习博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/07/20/利用ServletContext对象读取资源文件/" itemprop="url">
                  javaweb (四 )
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-07-20 12:10:37" itemprop="dateCreated datePublished" datetime="2018-07-20T12:10:37+08:00">2018-07-20</time>
            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/javaEE/" itemprop="url" rel="index"><span itemprop="name">javaEE</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="利用ServletContext对象读取资源文件"><a href="#利用ServletContext对象读取资源文件" class="headerlink" title="利用ServletContext对象读取资源文件"></a>利用ServletContext对象读取资源文件</h3><p>项目目录结构如下：<br><img src="/img/Demo8.png" alt=""></p>
<h4 id="代码范例：使用servletContext读取资源文件"><a href="#代码范例：使用servletContext读取资源文件" class="headerlink" title="代码范例：使用servletContext读取资源文件"></a>代码范例：使用servletContext读取资源文件</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line">import javax.servlet.ServletException;</span><br><span class="line">import javax.servlet.annotation.WebServlet;</span><br><span class="line">import javax.servlet.http.HttpServlet;</span><br><span class="line">import javax.servlet.http.HttpServletRequest;</span><br><span class="line">import javax.servlet.http.HttpServletResponse;</span><br><span class="line">import java.io.FileInputStream;</span><br><span class="line">import java.io.FileNotFoundException;</span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.io.InputStream;</span><br><span class="line">import java.text.MessageFormat;</span><br><span class="line">import java.util.Properties;</span><br><span class="line"></span><br><span class="line">@WebServlet(name = &quot;ServletContextDemo7&quot;)</span><br><span class="line">public class ServletContextDemo7 extends HttpServlet &#123;</span><br><span class="line">    protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException &#123;</span><br><span class="line">        doGet(request, response);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException &#123;</span><br><span class="line">/**</span><br><span class="line"> * response.setContentType(&quot;text/html;charset=UTF-8&quot;);目的是控制浏览器用UTF-8进行解码；</span><br><span class="line"> * 这样就不会出现中文乱码了</span><br><span class="line"> */</span><br><span class="line">        response.setHeader(&quot;content-type&quot;, &quot;text/html;charset=UTF-8&quot;);</span><br><span class="line">        readSrcDirPropCfgFile(response);//读取src目录下的properties配置文件</span><br><span class="line">        response.getWriter().println(&quot;&lt;hr/&gt;&quot;);</span><br><span class="line">        readWebRootDirPropCfgFile(response);//读取WebRoot目录下的properties配置文件</span><br><span class="line">        response.getWriter().println(&quot;&lt;hr/&gt;&quot;);</span><br><span class="line">        readPropCfgFile(response);//读取src目录下的db.config包中的db3.properties配置文件</span><br><span class="line">        response.getWriter().println(&quot;&lt;hr/&gt;&quot;);</span><br><span class="line">        readPropCfgFile2(response);//读取src目录下的包中的db4.properties配置文件</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void readPropCfgFile2(HttpServletResponse response) throws IOException &#123;</span><br><span class="line">        InputStream in = this.getServletContext().getResourceAsStream(&quot;/WEB-INF/classes/db4.properties&quot;);</span><br><span class="line">        Properties prop = new Properties();</span><br><span class="line">        prop.load(in);</span><br><span class="line">        String driver = prop.getProperty(&quot;driver&quot;);</span><br><span class="line">        String url = prop.getProperty(&quot;url&quot;);</span><br><span class="line">        String username = prop.getProperty(&quot;username&quot;);</span><br><span class="line">        String password = prop.getProperty(&quot;password&quot;);</span><br><span class="line">        response.getWriter().println(&quot;读取src目录下的db.config包中的db3.properties配置文件：&quot;);</span><br><span class="line">        response.getWriter().print(</span><br><span class="line">                MessageFormat.format(</span><br><span class="line">                        &quot;driver=&#123;0&#125;,url=&#123;1&#125;,username=&#123;2&#125;,password=&#123;3&#125;&quot;,</span><br><span class="line">                        driver,url, username, password)</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 读取src目录下的db.config包中的db3.properties配置文件</span><br><span class="line">     * @param response</span><br><span class="line">     * @throws IOException</span><br><span class="line">     */</span><br><span class="line">    private void readPropCfgFile(HttpServletResponse response) throws IOException &#123;</span><br><span class="line">        //通过ServletContext获取web资源的绝对路径</span><br><span class="line">        String path = this.getServletContext().getRealPath(&quot;/WEB-INF/classes/db/config/db3.properties&quot;);</span><br><span class="line">        InputStream in = new FileInputStream(path);</span><br><span class="line">        Properties prop = new Properties();</span><br><span class="line">        prop.load(in);</span><br><span class="line">        String driver = prop.getProperty(&quot;driver&quot;);</span><br><span class="line">        String url = prop.getProperty(&quot;url&quot;);</span><br><span class="line">        String username = prop.getProperty(&quot;username&quot;);</span><br><span class="line">        String password = prop.getProperty(&quot;password&quot;);</span><br><span class="line">        response.getWriter().println(&quot;读取src目录下的db.config包中的db3.properties配置文件：&quot;);</span><br><span class="line">        response.getWriter().print(</span><br><span class="line">                MessageFormat.format(</span><br><span class="line">                        &quot;driver=&#123;0&#125;,url=&#123;1&#125;,username=&#123;2&#125;,password=&#123;3&#125;&quot;,</span><br><span class="line">                        driver,url, username, password)</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 通过ServletContext对象读取WebRoot目录下的properties配置文件</span><br><span class="line">     * “/”代表的是项目根目录</span><br><span class="line">     * @param response</span><br><span class="line">     * @throws IOException</span><br><span class="line">     */</span><br><span class="line">    private void readWebRootDirPropCfgFile(HttpServletResponse response) throws IOException &#123;</span><br><span class="line">        InputStream in = this.getServletContext().getResourceAsStream(&quot;/db2.properties&quot;);</span><br><span class="line">        Properties prop = new Properties();</span><br><span class="line">        prop.load(in);</span><br><span class="line">        String driver = prop.getProperty(&quot;driver&quot;);</span><br><span class="line">        String url = prop.getProperty(&quot;url&quot;);</span><br><span class="line">        String username = prop.getProperty(&quot;username&quot;);</span><br><span class="line">        String password = prop.getProperty(&quot;password&quot;);</span><br><span class="line">        response.getWriter().println(&quot;读取WebRoot目录下的db2.properties配置文件：&quot;);</span><br><span class="line">        response.getWriter().print(</span><br><span class="line">                MessageFormat.format(</span><br><span class="line">                        &quot;driver=&#123;0&#125;,url=&#123;1&#125;,username=&#123;2&#125;,password=&#123;3&#125;&quot;,</span><br><span class="line">                        driver,url, username, password)</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 读取src目录下的db.config包中的db3.properties配置文件</span><br><span class="line">     *</span><br><span class="line">     * @param response</span><br><span class="line">     * @throws IOException</span><br><span class="line">     */</span><br><span class="line">    private void readSrcDirPropCfgFile(HttpServletResponse response) throws IOException &#123;</span><br><span class="line">        //通过ServletContext获取web资源的绝对路径</span><br><span class="line">        String path = this.getServletContext().getRealPath(&quot;/WEB-INF/classes/db/config/db3.properties&quot;);</span><br><span class="line">        InputStream in = new FileInputStream(path);</span><br><span class="line">        Properties prop = new Properties();</span><br><span class="line">        prop.load(in);</span><br><span class="line">        String driver = prop.getProperty(&quot;driver&quot;);</span><br><span class="line">        String url = prop.getProperty(&quot;url&quot;);</span><br><span class="line">        String username = prop.getProperty(&quot;username&quot;);</span><br><span class="line">        String password = prop.getProperty(&quot;password&quot;);</span><br><span class="line">        response.getWriter().println(&quot;读取src目录下的db.config包中的db3.properties配置文件：&quot;);</span><br><span class="line">        response.getWriter().println(</span><br><span class="line">                MessageFormat.format(&quot;driver=&#123;0&#125;,url=&#123;1&#125;,username=&#123;2&#125;,password=&#123;3&#125;&quot;, driver, url, username, password)</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>通过ServletContext对象读取src目录下的db1.properties配置文件<br>InputStream in = this.getServletContext().getResourceAsStream(“/WEB-INF/classes/db1.properties”);<ul>
<li>通过ServletContext对象读取WebRoot目录下的properties配置文件<br>InputStream in = this.getServletContext().getResourceAsStream(“/db2.properties”);</li>
<li>读取src目录下的db.config包中的db3.properties配置文件<br>String path = this.getServletContext().getRealPath(“/WEB-INF/classes/db/config/db3.properties”);<br>InputStream in = new FileInputStream(path);</li>
</ul>
</li>
<li>读取src目录下的gacl.servlet.study包中的db4.properties配置文件<br>InputStream in = this.getServletContext().getResourceAsStream(“/WEB-INF/db4.properties”);</li>
</ul>
<p>运行结果：<br><img src="/img/Demo7.png" alt=""></p>
<h4 id="代码范例：使用类装载器读取资源文件"><a href="#代码范例：使用类装载器读取资源文件" class="headerlink" title="代码范例：使用类装载器读取资源文件"></a>代码范例：使用类装载器读取资源文件</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line">import javax.servlet.ServletException;</span><br><span class="line">import javax.servlet.annotation.WebServlet;</span><br><span class="line">import javax.servlet.http.HttpServlet;</span><br><span class="line">import javax.servlet.http.HttpServletRequest;</span><br><span class="line">import javax.servlet.http.HttpServletResponse;</span><br><span class="line">import java.io.*;</span><br><span class="line">import java.text.MessageFormat;</span><br><span class="line">import java.util.Properties;</span><br><span class="line"></span><br><span class="line">@WebServlet(name = &quot;ServletContextDemo8&quot;)</span><br><span class="line">public class ServletContextDemo8 extends HttpServlet &#123;</span><br><span class="line">    protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException &#123;</span><br><span class="line">        doGet(request, response);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException &#123;</span><br><span class="line">        response.setContentType(&quot;text/html;charset=UTF-8&quot;);</span><br><span class="line">        //response.setHeader(&quot;content-type&quot;,&quot;text/html;charset=UTF-8&quot;);</span><br><span class="line">   test1(response);</span><br><span class="line">        response.getWriter().println(&quot;&lt;hr/&gt;&quot;);</span><br><span class="line">        test2(response);</span><br><span class="line">        response.getWriter().println(&quot;&lt;hr/&gt;&quot;);</span><br><span class="line">        //test3();//并没有成功</span><br><span class="line">        test4();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void test4() throws IOException &#123;</span><br><span class="line">        String path = this.getServletContext().getRealPath(&quot;/WEB-INF/classes/01.avi&quot;);</span><br><span class="line">        String filename = path.substring(path.lastIndexOf(&quot;\\&quot;) + 1);//获取文件名</span><br><span class="line">        InputStream in = this.getServletContext().getResourceAsStream(&quot;/WEB-INF/classes/01.avi&quot;);</span><br><span class="line">        byte buffer[] = new byte[1024];</span><br><span class="line">        int len = 0;</span><br><span class="line">        OutputStream out = new FileOutputStream(&quot;e:\\&quot; + filename);</span><br><span class="line">        while ((len = in.read(buffer))&gt;0)&#123;</span><br><span class="line">            out.write(buffer,0,len);</span><br><span class="line">        &#125;</span><br><span class="line">        out.close();</span><br><span class="line">        in.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     *  通过类装载器读取资源文件的注意事项:不适合装载大文件，否则会导致jvm内存溢出</span><br><span class="line">     */</span><br><span class="line">    private void test3() &#123;</span><br><span class="line">        /**</span><br><span class="line">         * 01.avi是一个60多M的文件，使用类加载器去读取这个大文件时会导致内存溢出：</span><br><span class="line">         * 01.pdf 是一个200多M的文件，</span><br><span class="line">         * java.lang.OutOfMemoryError: Java heap space</span><br><span class="line">         */</span><br><span class="line">        InputStream in = ServletContextDemo8.class.getClassLoader().getResourceAsStream(&quot;01.pdf&quot;);</span><br><span class="line">        System.out.println(in);</span><br><span class="line">        //并没有试验成功</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 读取类路径下面、包下面的资源文件</span><br><span class="line">     * @param response</span><br><span class="line">     * @throws IOException</span><br><span class="line">     */</span><br><span class="line">    private void test2(HttpServletResponse response) throws IOException &#123;</span><br><span class="line">        //获取到装载当前类的类装载器</span><br><span class="line">        ClassLoader loader = ServletContextDemo8.class.getClassLoader();</span><br><span class="line">        //用类装载器读取src目录下的db1.properties配置文件</span><br><span class="line">        InputStream in = loader.getResourceAsStream(&quot;db4.properties&quot;);</span><br><span class="line">        Properties prop = new Properties();</span><br><span class="line">        prop.load(in);</span><br><span class="line">        String driver = prop.getProperty(&quot;driver&quot;);</span><br><span class="line">        String url = prop.getProperty(&quot;url&quot;);</span><br><span class="line">        String username = prop.getProperty(&quot;username&quot;);</span><br><span class="line">        String password = prop.getProperty(&quot;password&quot;);</span><br><span class="line">        response.getWriter().println(&quot;用类装载器读取src目录下的db4.properties配置文件：&quot;);</span><br><span class="line">        response.getWriter().print(</span><br><span class="line">                MessageFormat.format(</span><br><span class="line">                        &quot;driver=&#123;0&#125;,url=&#123;1&#125;,username=&#123;2&#125;,password=&#123;3&#125;&quot;,</span><br><span class="line">                        driver,url, username, password)</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 读取类路径下的资源文件</span><br><span class="line">     * @param response</span><br><span class="line">     * @throws IOException</span><br><span class="line">     */</span><br><span class="line">    private void test1(HttpServletResponse response) throws IOException &#123;</span><br><span class="line">        //获取到装载当前类的类装载器</span><br><span class="line">        ClassLoader loader = ServletContextDemo8.class.getClassLoader();</span><br><span class="line">        //用类装载器读取src目录下的db1.properties配置文件</span><br><span class="line">        InputStream in = loader.getResourceAsStream(&quot;db1.properties&quot;);</span><br><span class="line">        Properties prop = new Properties();</span><br><span class="line">        prop.load(in);</span><br><span class="line">        String driver = prop.getProperty(&quot;driver&quot;);</span><br><span class="line">        String url = prop.getProperty(&quot;url&quot;);</span><br><span class="line">        String username = prop.getProperty(&quot;username&quot;);</span><br><span class="line">        String password = prop.getProperty(&quot;password&quot;);</span><br><span class="line">        response.getWriter().println(&quot;用类装载器读取src目录下的db1.properties配置文件：&quot;);</span><br><span class="line">        response.getWriter().print(</span><br><span class="line">                MessageFormat.format(</span><br><span class="line">                        &quot;driver=&#123;0&#125;,url=&#123;1&#125;,username=&#123;2&#125;,password=&#123;3&#125;&quot;,</span><br><span class="line">                        driver,url, username, password)</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/img/Demo81.png" alt=""></p>
<h3 id="在客户端缓存Servlet的输出"><a href="#在客户端缓存Servlet的输出" class="headerlink" title="在客户端缓存Servlet的输出"></a>在客户端缓存Servlet的输出</h3><p>对于不经常变化的数据，在servlet中可以为其设置合理的缓存时间值，以避免浏览器频繁向服务器发送请求，提升服务器的性能。例如在ServletContextDemo5的doGet()方法<br>添加如下代码：</p>
<p> response.setDateHeader(“expires”,System.currentTimeMillis() + 24 <em> 3600 </em> 1000);<br> 找到浏览器缓存如图<br> <img src="/img/Demo82.png" alt=""></p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/8/">8</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.gif"
                alt="Qgx" />
            
              <p class="site-author-name" itemprop="name">Qgx</p>
              <p class="site-description motion-element" itemprop="description">漫漫长路，伴你同行</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">79</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">7</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">53</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  <a href="https://github.com/qin12" target="_blank" title="GitHub"><i class="fa fa-fw fa-github"></i>GitHub</a>
                  
                </span>
              
                <span class="links-of-author-item">
                  <a href="mailto:1520290900@qq.com" target="_blank" title="E-Mail"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  
                </span>
              
                <span class="links-of-author-item">
                  <a href="tencent://AddContact/?fromId=45&fromSubId=1&subcmd=all&uin=1520290900&website=www.oicqzone.com" target="_blank" title="QQ"><i class="fa fa-fw fa-QQ"></i>QQ</a>
                  
                </span>
              
            </div>
          

          
          

          
          

          
            
          
          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Qgx</span>

  

  
</div>




  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动 v3.7.1</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/theme-next/hexo-theme-next">NexT.Mist</a> v6.2.0</div>



<div class="powered-by">
<i class="fa fa-user-md"></i><span id="busuanzi_container_site_uv">
  本站访客数:<span id="busuanzi_value_site_uv"></span>
</span>
</div>


        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>














  













  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.2.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.2.0"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.2.0"></script>



  



	





  





  










  





  

  

  

  

  
  

  

  

  

  

  

  <script type="text/javascript" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js"></script>
</body>
</html>
